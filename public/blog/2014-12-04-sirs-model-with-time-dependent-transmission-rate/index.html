<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">

  
  
  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  

  
  <title>SIRS Model with Time Dependent Transmission Rate</title>

  
  
  <link rel="stylesheet" href="http://blog.tonytsai.name/css/hugo-octopress.css">

  
  

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

  
  <link href="http://blog.tonytsai.name/favicon.png" rel="icon">

  
  
  

  

  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="author" content="Tony Tsai">

  
  <meta name="generator" content="Hugo 0.18.1" />

  
  
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-40665800-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


</head>
<body>


<header role="banner"><hgroup>
  
  <h1><a href="http://blog.tonytsai.name/">Tony Tsai</a></h1>
    <h2>May the force of science be with you</h2>
</hgroup></header>


<nav role="navigation">

<ul class="main-navigation">
  
  
    
      <li><a href="http://blog.tonytsai.name/" title="Blog">Blog</a></li>
    
  
    
      <li><a href="http://tonytsai.name/cv.pdf" title="Resume"  target="_blank" >Resume</a></li>
    
  
    
      <li><a href="http://blog.tonytsai.name/douban/" title="Douban"  target="_blank" >Douban</a></li>
    
  
    
      <li><a href="http://blog.tonytsai.name/archive/" title="Archive"  target="_blank" >Archive</a></li>
    
  
</ul>


<ul class="subscription">
  
    
        <a href="http://blog.tonytsai.name/index.xml" target="_blank" type="application/rss+xml" title="RSS"><i class="fa fa-rss-square fa-lg"></i></a>
    
  

</ul>


</nav>


<div id="main">
  <div id="content">
    <div>
      <article class="hentry" role="article">

        
        

<header>
    <p class="meta">Dec 4, 2014
         - 16 minute read 
         - <a href="http://blog.tonytsai.name/blog/2014-12-04-sirs-model-with-time-dependent-transmission-rate/#disqus_thread">Comments</a>

        
        
        
            - <a class="label" href="http://blog.tonytsai.name/categories/influenza/">Influenza </a>
        
    </p>
    <h1 class="entry-title">
         SIRS Model with Time Dependent Transmission Rate 
    </h1>
</header>


        <div class="entry-content">
          
          
          
          
<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
<a class="a2a_dd" href="https://www.addtoany.com/share"></a>
<a class="a2a_button_facebook"></a>
<a class="a2a_button_twitter"></a>
<a class="a2a_button_sina_weibo"></a>
<a class="a2a_button_wechat"></a>
<a class="a2a_button_douban"></a>
<a class="a2a_button_evernote"></a>
<a class="a2a_button_email"></a>
</div>
<script async src="https://static.addtoany.com/menu/page.js"></script>

<br>

          

<h2 id="1-sirs-model">1 SIRS Model</h2>

<p>The <a href="http://en.wikipedia.org/wiki/Epidemic_model#The_SIRS_model" target="_blank">SIRS model</a> is simply an extension of the <a href="http://en.wikipedia.org/wiki/Epidemic_model#The_SIR_model" target="_blank">SIR model</a> as it allows members of the recovered class to rejoin the susceptible class at a defined rate, which integrates the impact of waning immunity following antigenic drift. Similar to the SIR model, a fixed population without births and deaths is considered in the SIRS model. The standard form of SIRS model is described as
$$
\begin{equation}
\begin{aligned}
  &amp; \frac{dS}{dt} = fR - \frac{\beta SI}{N} \\<br />
  &amp; \frac{dI}{dt} = \frac{\beta SI}{N} - \gamma I \\<br />
  &amp; \frac{dR}{dt} = \gamma I - fR
\end{aligned}
\label{eq1}
\end{equation}
$$
where $f$ is the average loss of immunity rate of recovered indiviuals, and the other notations are the same as the SIR model. Note that SIR model is a special case  of SIRS model under condition of $f = 0$. Hence, it is possible to create a general function to solve both SIR and SIRS models.</p>

<p>As only two of the three ODEs are independent, $R(t)$ does not have to be treated explicitly and using ODEs of $S(t)$ and $I(t)$ to describe the dynamic of SIRS model are adequate. Substitute $R(t) = N - S(t) - I(t)$ into ODE of $S(t)$ and the formula is simplified as follows
$$
\begin{equation}
\begin{aligned}
  &amp; \frac{dS}{dt} = f(N - S - I) - \frac{\beta SI}{N} \\<br />
  &amp; \frac{dI}{dt} = \frac{\beta SI}{N} - \gamma I
\end{aligned}
\label{eq2}
\end{equation}
$$</p>

<p>The form of SIRS model described in <a href="http://www.pnas.org/content/101/48/16915.abstract" target="_blank">Dushoff et al. (2004)</a> and <a href="http://www.plosbiology.org/article/info%3Adoi%2F10.1371%2Fjournal.pbio.1000316" target="_blank">Shaman et al. (2010)</a> is as follows
$$
\begin{equation}
\begin{aligned} \label{eq3}
  &amp; \frac{dS}{dt} = \frac{N - S - I}{L} - \frac{\beta SI}{N} \\<br />
  &amp; \frac{dI}{dt} = \frac{\beta SI}{N} - \frac{I}{D}
\end{aligned}
\end{equation}
$$
where $L$ is the average duration of immunity of recoverd indiviuals, and $D$ is the mean infectious period of infected indiviuals. Comparing with ODEs $(\ref{eq2})$, $L = \frac{1}{f}$ and $D = \frac{1}{\gamma}$ are derived.</p>

<p>In the following subsections, <strong>RK4</strong> method is applied to solve SIRS model in different forms.</p>

<h3 id="1-1-rk4sirs-std-function">1.1 <code>RK4SIRS.std</code> function</h3>

<p>The iterative formula of <strong>RK4</strong> method for solving SIRS model in the standard form $(\ref{eq1})$ can be easily derived and won&rsquo;t be presented here. The following codes firstly define four helper functions. Three of them describe $S(t)$, $I(t)$ and $R(t)$ compartments of SIRS model. The other one defines the <strong>infection rate</strong> (see Table 1 in <a href="http://www.pnas.org/content/101/48/16915.abstract" target="_blank">Dushoff et al. (2004)</a>) to calculate cummulative incidence. Different from SIR model, the infection rate is only the second term of $S(t)$ compartment in SIRS model. Therefore, an additional helper function is needed to separately define the infection rate.</p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span><span style="color: #586E75"># define S, I, R compartments of SIRS model</span>
dSdt.std <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> S<span style="color: #93A1A1">,</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">,</span> R<span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span>f <span style="color: #719e07">*</span> R <span style="color: #719e07">-</span> beta <span style="color: #719e07">*</span> S <span style="color: #719e07">*</span> I <span style="color: #719e07">/</span> N<span style="color: #93A1A1">)</span>
<span style="color: #93A1A1">}</span>

dIdt.std <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> S<span style="color: #93A1A1">,</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span>beta <span style="color: #719e07">*</span> S <span style="color: #719e07">*</span> I <span style="color: #719e07">/</span> N <span style="color: #719e07">-</span> gamma <span style="color: #719e07">*</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span>
<span style="color: #93A1A1">}</span>

dRdt.std <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">,</span> R<span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span>gamma <span style="color: #719e07">*</span> I <span style="color: #719e07">-</span> f <span style="color: #719e07">*</span> R<span style="color: #93A1A1">)</span>
<span style="color: #93A1A1">}</span>

<span style="color: #586E75"># define infection rate</span>
dCIdt.std <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> S<span style="color: #93A1A1">,</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span>beta <span style="color: #719e07">*</span> S <span style="color: #719e07">*</span> I <span style="color: #719e07">/</span> N<span style="color: #93A1A1">)</span>
<span style="color: #93A1A1">}</span>
</pre></div>

<p>The iterative algorithm for calculating cummumcaltive incidence resembles those of $S(t)$, $I(t)$ and $R(t)$. The implementation of <strong>RK4</strong> method for SIRS model is presented as follows.</p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span><span style="color: #586E75"># RK4 method for the numerical integration of SIRS model in standard form</span>
RK4SIRS.std <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span>n<span style="color: #93A1A1">,</span> <span style="color: #719e07">beta</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> f<span style="color: #93A1A1">,</span> S0<span style="color: #93A1A1">,</span> I0<span style="color: #93A1A1">,</span> R0 <span style="color: #719e07">=</span> <span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> dt <span style="color: #719e07">=</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">,</span> incidence <span style="color: #719e07">=</span> <span style="color: #CB4B16">FALSE</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  N <span style="color: #719e07">&lt;&lt;-</span> S0 <span style="color: #719e07">+</span> I0 <span style="color: #719e07">+</span> R0
  
  S <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>S0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>
  I <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>I0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>
  R <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>R0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>
  CI <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>I0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>  <span style="color: #586E75"># cummulative incidence</span>
  <span style="color: #268BD2">for</span> <span style="color: #93A1A1">(</span>i <span style="color: #268BD2">in</span> <span style="color: #2AA198">1</span><span style="color: #719e07">:</span>n<span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
    Si <span style="color: #719e07">&lt;-</span> S<span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    Ii <span style="color: #719e07">&lt;-</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    Ri <span style="color: #719e07">&lt;-</span> R<span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    CIi <span style="color: #719e07">&lt;-</span> CI<span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    
    S.k1 <span style="color: #719e07">&lt;-</span> dSdt.std<span style="color: #93A1A1">(</span>i<span style="color: #93A1A1">,</span> Si<span style="color: #93A1A1">,</span> Ii<span style="color: #93A1A1">,</span> Ri<span style="color: #93A1A1">)</span>
    I.k1 <span style="color: #719e07">&lt;-</span> dIdt.std<span style="color: #93A1A1">(</span>i<span style="color: #93A1A1">,</span> Si<span style="color: #93A1A1">,</span> Ii<span style="color: #93A1A1">)</span>
    R.k1 <span style="color: #719e07">&lt;-</span> dRdt.std<span style="color: #93A1A1">(</span>i<span style="color: #93A1A1">,</span> Ii<span style="color: #93A1A1">,</span> Ri<span style="color: #93A1A1">)</span>
    CI.k1 <span style="color: #719e07">&lt;-</span> dCIdt.std<span style="color: #93A1A1">(</span>i<span style="color: #93A1A1">,</span> Si<span style="color: #93A1A1">,</span> Ii<span style="color: #93A1A1">)</span>
    
    S.k2 <span style="color: #719e07">&lt;-</span> dSdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k1<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k1<span style="color: #93A1A1">,</span> Ri <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> R.k1<span style="color: #93A1A1">)</span>
    I.k2 <span style="color: #719e07">&lt;-</span> dIdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k1<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k1<span style="color: #93A1A1">)</span>
    R.k2 <span style="color: #719e07">&lt;-</span> dRdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k1<span style="color: #93A1A1">,</span> Ri <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> R.k1<span style="color: #93A1A1">)</span>
    CI.k2 <span style="color: #719e07">&lt;-</span> dCIdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k1<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k1<span style="color: #93A1A1">)</span>
    
    S.k3 <span style="color: #719e07">&lt;-</span> dSdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k2<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2<span style="color: #93A1A1">,</span> Ri <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> R.k2<span style="color: #93A1A1">)</span>
    I.k3 <span style="color: #719e07">&lt;-</span> dIdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k2<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2<span style="color: #93A1A1">)</span>
    R.k3 <span style="color: #719e07">&lt;-</span> dRdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2<span style="color: #93A1A1">,</span> Ri <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> R.k2<span style="color: #93A1A1">)</span>
    CI.k3 <span style="color: #719e07">&lt;-</span> dCIdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k2<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2<span style="color: #93A1A1">)</span>
    
    S.k4 <span style="color: #719e07">&lt;-</span> dSdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> S.k3<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> I.k3<span style="color: #93A1A1">,</span> Ri <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> R.k3<span style="color: #93A1A1">)</span>
    I.k4 <span style="color: #719e07">&lt;-</span> dIdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> S.k3<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> I.k3<span style="color: #93A1A1">)</span>
    R.k4 <span style="color: #719e07">&lt;-</span> dRdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> I.k3<span style="color: #93A1A1">,</span> Ri <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> R.k3<span style="color: #93A1A1">)</span>
    CI.k4 <span style="color: #719e07">&lt;-</span> dCIdt.std<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> S.k3<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> I.k3<span style="color: #93A1A1">)</span>
    
    S<span style="color: #93A1A1">[</span>i <span style="color: #719e07">+</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">]</span> <span style="color: #719e07">&lt;-</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">6</span> <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>S.k1 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k2 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k3 <span style="color: #719e07">+</span> S.k4<span style="color: #93A1A1">)</span>
    <span style="color: #719e07">I</span><span style="color: #93A1A1">[</span>i <span style="color: #719e07">+</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">]</span> <span style="color: #719e07">&lt;-</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">6</span> <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>I.k1 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k3 <span style="color: #719e07">+</span> I.k4<span style="color: #93A1A1">)</span>
    R<span style="color: #93A1A1">[</span>i <span style="color: #719e07">+</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">]</span> <span style="color: #719e07">&lt;-</span> Ri <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">6</span> <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>R.k1 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> R.k2 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> R.k3 <span style="color: #719e07">+</span> R.k4<span style="color: #93A1A1">)</span>
    CI<span style="color: #93A1A1">[</span>i <span style="color: #719e07">+</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">]</span> <span style="color: #719e07">&lt;-</span> CIi <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">6</span> <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>CI.k1 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> CI.k2 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> CI.k3 <span style="color: #719e07">+</span> CI.k4<span style="color: #93A1A1">)</span>
  <span style="color: #93A1A1">}</span>
  <span style="color: #268BD2">if</span> <span style="color: #93A1A1">(</span><span style="color: #719e07">!</span>incidence<span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
    <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span><span style="color: #DC322F">data.frame</span><span style="color: #93A1A1">(</span>n <span style="color: #719e07">=</span> <span style="color: #2AA198">0</span> <span style="color: #719e07">:</span> n<span style="color: #93A1A1">,</span> S <span style="color: #719e07">=</span> S<span style="color: #93A1A1">,</span> I <span style="color: #719e07">=</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">,</span> R <span style="color: #719e07">=</span> R<span style="color: #93A1A1">))</span>
  <span style="color: #93A1A1">}</span> <span style="color: #268BD2">else</span> <span style="color: #93A1A1">{</span>
    <span style="color: #586E75"># newly infected per day (incidence)</span>
    inc <span style="color: #719e07">=</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>I0<span style="color: #93A1A1">,</span> <span style="color: #719e07">diff</span><span style="color: #93A1A1">(</span>CI<span style="color: #93A1A1">))</span>
    <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span><span style="color: #DC322F">data.frame</span><span style="color: #93A1A1">(</span>n <span style="color: #719e07">=</span> <span style="color: #2AA198">0</span> <span style="color: #719e07">:</span> n<span style="color: #93A1A1">,</span> S <span style="color: #719e07">=</span> S<span style="color: #93A1A1">,</span> I <span style="color: #719e07">=</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">,</span> R <span style="color: #719e07">=</span> R<span style="color: #93A1A1">,</span> inc <span style="color: #719e07">=</span> inc<span style="color: #93A1A1">,</span> cum.inc <span style="color: #719e07">=</span> CI<span style="color: #93A1A1">))</span>
  <span style="color: #93A1A1">}</span>
<span style="color: #93A1A1">}</span>
</pre></div>

<h3 id="1-2-rk4sirs-function">1.2 <code>RK4SIRS</code> function</h3>

<p>There are many repetitive computations in the implementation of <code>RK4SIRS.std</code> function, especially for calculating cummulative incidence. Actually, the system of ODEs of SIRS model describes the transition of an individual between susceptible, infectious, and recovered states. For SIRS model in simplified form $(\ref{eq2})$, only susceptible and infectious states are necessary to represent the system state and the system state at time $t$ is usually expressed as state vector $\mathbf{Z}(t)\equiv (S(t), I(t))$. As presented in Table 1, infection, recovery, and immunity loss events can change the system state at a rate of $\frac{\beta SI}{N}$, $\gamma I$, and $f(N-S-I)$, respectively.</p>

<p>Table 1:  Markov chain transition rate (source: <a href="http://www.pnas.org/content/101/48/16915.abstract" target="_blank">Dushoff et al. (2004)</a>) <!-- how to generate table caption, which is supported in pandoc --></p>

<table>
<thead>
<tr>
<th>Event</th>
<th>Change</th>
<th>Rate</th>
</tr>
</thead>

<tbody>
<tr>
<td>Infection</td>
<td>$(S,I)\rightarrow (S-1,I+1)$</td>
<td>$\frac{\beta SI}{N}$</td>
</tr>

<tr>
<td>Recovery</td>
<td>$(S,I)\rightarrow (S, I-1)$</td>
<td>$\gamma I$</td>
</tr>

<tr>
<td>Immunity loss</td>
<td>$(S,I)\rightarrow (S+1, I)$</td>
<td>$f(N-S-I)$</td>
</tr>
</tbody>
</table>

<p>Instead of directly defining $S(t)$ and $I(t)$ compartments of SIRS model, using helper functions to define the events can avoid redundant computing as events describe the changes in system state at fine-grained scale. According to Table 1, <strong>RK4</strong> method for solving SIRS model in simplified form $(\ref{eq2})$ can be easily implemented by slightly modified from <code>RK4SIRS.std</code> function.</p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span><span style="color: #586E75"># define infection rate</span>
inf.rate <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> S<span style="color: #93A1A1">,</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span>beta <span style="color: #719e07">*</span> S <span style="color: #719e07">*</span> I <span style="color: #719e07">/</span> N<span style="color: #93A1A1">)</span>
<span style="color: #93A1A1">}</span>

<span style="color: #586E75"># define recovery rate</span>
rec.rate <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span>gamma <span style="color: #719e07">*</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span>
<span style="color: #93A1A1">}</span>

<span style="color: #586E75"># define immunity loss rate</span>
ilos.rate <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> S<span style="color: #93A1A1">,</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span>f <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>N <span style="color: #719e07">-</span> S <span style="color: #719e07">-</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">))</span>
<span style="color: #93A1A1">}</span>

<span style="color: #586E75"># RK4 method for numerical integration of SIRS model in simplified form</span>
RK4SIRS <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span>n<span style="color: #93A1A1">,</span> <span style="color: #719e07">beta</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> f<span style="color: #93A1A1">,</span> S0<span style="color: #93A1A1">,</span> I0<span style="color: #93A1A1">,</span> R0 <span style="color: #719e07">=</span> <span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> dt <span style="color: #719e07">=</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">,</span> incidence <span style="color: #719e07">=</span> <span style="color: #CB4B16">FALSE</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  N <span style="color: #719e07">&lt;&lt;-</span> S0 <span style="color: #719e07">+</span> I0 <span style="color: #719e07">+</span> R0
  
  S <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>S0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>
  I <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>I0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>
  R <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>R0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>
  CI <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>I0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>  <span style="color: #586E75"># cummulative incidence</span>
  <span style="color: #268BD2">for</span> <span style="color: #93A1A1">(</span>i <span style="color: #268BD2">in</span> <span style="color: #2AA198">1</span><span style="color: #719e07">:</span>n<span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
    Si <span style="color: #719e07">&lt;-</span> S<span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    Ii <span style="color: #719e07">&lt;-</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    Ri <span style="color: #719e07">&lt;-</span> R<span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    CIi <span style="color: #719e07">&lt;-</span> CI<span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    
    Einf <span style="color: #719e07">&lt;-</span> inf.rate<span style="color: #93A1A1">(</span>i<span style="color: #93A1A1">,</span> Si<span style="color: #93A1A1">,</span> Ii<span style="color: #93A1A1">)</span>  <span style="color: #586E75"># event of infection</span>
    Erec <span style="color: #719e07">&lt;-</span> rec.rate<span style="color: #93A1A1">(</span>i<span style="color: #93A1A1">,</span> Ii<span style="color: #93A1A1">)</span>  <span style="color: #586E75"># event of recovery</span>
    Eilos <span style="color: #719e07">&lt;-</span> ilos.rate<span style="color: #93A1A1">(</span>i<span style="color: #93A1A1">,</span> Si<span style="color: #93A1A1">,</span> Ii<span style="color: #93A1A1">)</span>  <span style="color: #586E75"># event of immunity loss</span>
    S.k1 <span style="color: #719e07">&lt;-</span> Eilos <span style="color: #719e07">-</span> Einf
    I.k1 <span style="color: #719e07">&lt;-</span> Einf <span style="color: #719e07">-</span> Erec
    CI.k1 <span style="color: #719e07">&lt;-</span> Einf
    
    Einf <span style="color: #719e07">&lt;-</span> inf.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k1<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k1<span style="color: #93A1A1">)</span>
    Erec <span style="color: #719e07">&lt;-</span> rec.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k1<span style="color: #93A1A1">)</span>
    Eilos <span style="color: #719e07">&lt;-</span> ilos.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k1<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k1<span style="color: #93A1A1">)</span>
    S.k2 <span style="color: #719e07">&lt;-</span> Eilos <span style="color: #719e07">-</span> Einf
    I.k2 <span style="color: #719e07">&lt;-</span> Einf <span style="color: #719e07">-</span> Erec
    CI.k2 <span style="color: #719e07">&lt;-</span> Einf
    
    Einf <span style="color: #719e07">&lt;-</span> inf.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k2<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2<span style="color: #93A1A1">)</span>
    Erec <span style="color: #719e07">&lt;-</span> rec.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2<span style="color: #93A1A1">)</span>
    Eilos <span style="color: #719e07">&lt;-</span> ilos.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k2<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2<span style="color: #93A1A1">)</span>
    S.k3 <span style="color: #719e07">&lt;-</span> Eilos <span style="color: #719e07">-</span> Einf
    I.k3 <span style="color: #719e07">&lt;-</span> Einf <span style="color: #719e07">-</span> Erec
    CI.k3 <span style="color: #719e07">&lt;-</span> Einf
    
    Einf <span style="color: #719e07">&lt;-</span> inf.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> S.k3<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> I.k3<span style="color: #93A1A1">)</span>
    Erec <span style="color: #719e07">&lt;-</span> rec.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> I.k3<span style="color: #93A1A1">)</span>
    Eilos <span style="color: #719e07">&lt;-</span> ilos.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> S.k3<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> I.k3<span style="color: #93A1A1">)</span>
    S.k4 <span style="color: #719e07">&lt;-</span> Eilos <span style="color: #719e07">-</span> Einf
    I.k4 <span style="color: #719e07">&lt;-</span> Einf <span style="color: #719e07">-</span> Erec
    CI.k4 <span style="color: #719e07">&lt;-</span> Einf
    
    S<span style="color: #93A1A1">[</span>i <span style="color: #719e07">+</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">]</span> <span style="color: #719e07">&lt;-</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">6</span> <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>S.k1 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k2 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k3 <span style="color: #719e07">+</span> S.k4<span style="color: #93A1A1">)</span>
    <span style="color: #719e07">I</span><span style="color: #93A1A1">[</span>i <span style="color: #719e07">+</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">]</span> <span style="color: #719e07">&lt;-</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">6</span> <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>I.k1 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k3 <span style="color: #719e07">+</span> I.k4<span style="color: #93A1A1">)</span>
    CI<span style="color: #93A1A1">[</span>i <span style="color: #719e07">+</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">]</span> <span style="color: #719e07">&lt;-</span> CIi <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">6</span> <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>CI.k1 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> CI.k2 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> CI.k3 <span style="color: #719e07">+</span> CI.k4<span style="color: #93A1A1">)</span>
  <span style="color: #93A1A1">}</span>
  R <span style="color: #719e07">&lt;-</span> N <span style="color: #719e07">-</span> S <span style="color: #719e07">-</span> <span style="color: #719e07">I</span>
  
  <span style="color: #268BD2">if</span> <span style="color: #93A1A1">(</span><span style="color: #719e07">!</span>incidence<span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
    <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span><span style="color: #DC322F">data.frame</span><span style="color: #93A1A1">(</span>n <span style="color: #719e07">=</span> <span style="color: #2AA198">0</span> <span style="color: #719e07">:</span> n<span style="color: #93A1A1">,</span> S <span style="color: #719e07">=</span> S<span style="color: #93A1A1">,</span> I <span style="color: #719e07">=</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">,</span> R <span style="color: #719e07">=</span> R<span style="color: #93A1A1">))</span>
  <span style="color: #93A1A1">}</span> <span style="color: #268BD2">else</span> <span style="color: #93A1A1">{</span>
    <span style="color: #586E75"># newly infected per day (incidence)</span>
    inc <span style="color: #719e07">=</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>I0<span style="color: #93A1A1">,</span> <span style="color: #719e07">diff</span><span style="color: #93A1A1">(</span>CI<span style="color: #93A1A1">))</span>
    <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span><span style="color: #DC322F">data.frame</span><span style="color: #93A1A1">(</span>n <span style="color: #719e07">=</span> <span style="color: #2AA198">0</span> <span style="color: #719e07">:</span> n<span style="color: #93A1A1">,</span> S <span style="color: #719e07">=</span> S<span style="color: #93A1A1">,</span> I <span style="color: #719e07">=</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">,</span> R <span style="color: #719e07">=</span> R<span style="color: #93A1A1">,</span> inc <span style="color: #719e07">=</span> inc<span style="color: #93A1A1">,</span> cum.inc <span style="color: #719e07">=</span> CI<span style="color: #93A1A1">))</span>
  <span style="color: #93A1A1">}</span>
<span style="color: #93A1A1">}</span>
</pre></div>

<h3 id="1-3-rk4-function">1.3 <code>rk4</code> function</h3>

<p>Using <code>rk4</code> function from <code>deSolve</code> package to solve SIRS model only needs to redefine the model and the vector of parameters used in SIRS model.</p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span><span style="color: #586E75"># vector of parameters used in SIRS model</span>
params <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>beta <span style="color: #719e07">=</span> <span style="color: #719e07">beta</span><span style="color: #93A1A1">,</span> gamma <span style="color: #719e07">=</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> f <span style="color: #719e07">=</span> f<span style="color: #93A1A1">)</span>
<span style="color: #586E75"># definition of SIRS model</span>
SIRS <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> y<span style="color: #93A1A1">,</span> params<span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #719e07">with</span><span style="color: #93A1A1">(</span><span style="color: #719e07">as.list</span><span style="color: #93A1A1">(</span><span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>params<span style="color: #93A1A1">,</span> y<span style="color: #93A1A1">)),</span> <span style="color: #93A1A1">{</span>
    dS <span style="color: #719e07">&lt;-</span> f <span style="color: #719e07">*</span> R <span style="color: #719e07">-</span> beta <span style="color: #719e07">*</span> S <span style="color: #719e07">*</span> I <span style="color: #719e07">/</span> N
    dI <span style="color: #719e07">&lt;-</span> beta <span style="color: #719e07">*</span> S <span style="color: #719e07">*</span> I <span style="color: #719e07">/</span> N <span style="color: #719e07">-</span> gamma <span style="color: #719e07">*</span> <span style="color: #719e07">I</span>
    dR <span style="color: #719e07">&lt;-</span> gamma <span style="color: #719e07">*</span> I <span style="color: #719e07">-</span> f <span style="color: #719e07">*</span> R
    <span style="color: #DC322F">list</span><span style="color: #93A1A1">(</span><span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>dS<span style="color: #93A1A1">,</span> dI<span style="color: #93A1A1">,</span> dR<span style="color: #93A1A1">))</span>
  <span style="color: #93A1A1">})</span>
<span style="color: #93A1A1">}</span>
</pre></div>

<p>The above three functions are tested with the same study case of the spread of Hong Kong flu in New York city and they all give the same results. Note that the parameter $f = \frac{1}{L} = \frac{1}{3.86 \times 365}$ comes from the parameters combination for generation of synthetic truth in <a href="http://www.pnas.org/content/109/50/20425.abstract" target="_blank">Shaman and Karspeck (2012)</a>. Here, only results given by <code>RK4SIRS</code> function are presented to avoid redundancy.</p>

<p><img src="http://tonytsai.name/materials/SIRS_files/figure-html/unnamed-chunk-5-1.png" alt="" /></p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span><span style="color: #586E75"># peak of the infected</span>
<span style="color: #719e07">which.max</span><span style="color: #93A1A1">(</span>r<span style="color: #719e07">$I</span><span style="color: #93A1A1">)</span>
</pre></div>

<pre><code>## [1] 75
</code></pre>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span><span style="color: #719e07">max</span><span style="color: #93A1A1">(</span>r<span style="color: #719e07">$I</span><span style="color: #93A1A1">)</span>
</pre></div>

<pre><code>## [1] 499451.1
</code></pre>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span><span style="color: #586E75"># peak of incidence</span>
<span style="color: #719e07">which.max</span><span style="color: #93A1A1">(</span>r<span style="color: #719e07">$</span>inc<span style="color: #93A1A1">)</span>
</pre></div>

<pre><code>## [1] 73
</code></pre>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span><span style="color: #719e07">max</span><span style="color: #93A1A1">(</span>r<span style="color: #719e07">$</span>inc<span style="color: #93A1A1">)</span>
</pre></div>

<pre><code>## [1] 174175.2
</code></pre>

<h3 id="1-4-benchmark">1.4 Benchmark</h3>

<p><code>RK4SIRS.std</code>, <code>RK4SIRS</code> and <code>rk4</code> are separately runned 1000 times for benchmark performance analysis.</p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span>compare <span style="color: #719e07">&lt;-</span> microbenchmark<span style="color: #93A1A1">(</span>rk4<span style="color: #93A1A1">(</span>y0<span style="color: #93A1A1">,</span> times<span style="color: #93A1A1">,</span> SIRS<span style="color: #93A1A1">,</span> params<span style="color: #93A1A1">),</span> 
                          RK4SIRS<span style="color: #93A1A1">(</span>n<span style="color: #93A1A1">,</span> <span style="color: #719e07">beta</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> f<span style="color: #93A1A1">,</span> S0<span style="color: #93A1A1">,</span> I0<span style="color: #93A1A1">,</span> incidence <span style="color: #719e07">=</span> <span style="color: #CB4B16">TRUE</span><span style="color: #93A1A1">),</span> 
                          RK4SIRS.std<span style="color: #93A1A1">(</span>n<span style="color: #93A1A1">,</span> <span style="color: #719e07">beta</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> f<span style="color: #93A1A1">,</span> S0<span style="color: #93A1A1">,</span> I0<span style="color: #93A1A1">,</span> incidence <span style="color: #719e07">=</span> <span style="color: #CB4B16">TRUE</span><span style="color: #93A1A1">),</span> 
                          times <span style="color: #719e07">=</span> <span style="color: #2AA198">10</span><span style="color: #93A1A1">)</span>
</pre></div>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span>compare
</pre></div>

<pre><code>## Unit: milliseconds
##         expr       min        lq      mean    median        uq       max
##          rk4 27.804584 29.519107 30.347914 30.938286 31.275767 32.472944
##      RK4SIRS  6.015463  6.542592  7.377228  7.411822  8.341024  8.769777
##  RK4SIRS.std  8.610047  9.109195  9.961587  9.599131 10.197847 12.959678
##  neval
##     10
##     10
##     10
</code></pre>

<p><img src="http://tonytsai.name/materials/SIRS_files/figure-html/unnamed-chunk-11-1.png" alt="" />
As shown in the above figure, <code>RK4SIRS</code> function runs the fastest. Subsequently, SIRS model will be solved in simplified form \eqref{eq:2}.</p>

<h3 id="1-5-basic-reproductive-number-r-0">1.5 Basic Reproductive Number $R_0$</h3>

<p>Technically, the <a href="http://en.wikipedia.org/wiki/Basic_reproduction_number" target="_blank">basic reproductive number</a> $R_0$ is defined as the number of secondary infections caused by a single infective introduced into a population made up entirely of susceptible individuals over the course of the infection of this single infective. For the susceptible population ($S_0 \approx N$), this infective individual makes $\beta$ contacts per unit time producing new infections with a mean infectious period of $D$. Therefore, the basic reproduction number is
$$
\begin{equation} \label{eq4}
  R_0 = \beta D = \frac{\beta}{\gamma}
\end{equation}
$$</p>

<p>Actually, the basic reproductive number is often compared to <strong>1</strong> to determine whether an epidemic occurs or the disease simply dies out.</p>

<h2 id="2-time-dependent-transmission-rate-beta-t">2 Time Dependent Transmission Rate $\beta(t)$</h2>

<p>Equation $(6)$ in <strong>Effects of Absolute Humidity on Influenza Virus</strong> shows the relationship between basic reproductive number $R_0(t)$ and specific humidity $q(t)$ at time $t$. Combining with equation $(\ref{eq4})$, it&rsquo;s easy to deduce that transmission rate $\beta$ is also modulated by specific humidity $q$ and time dependent. Hence, replacing the constant $\beta$ in ODEs $(\ref{eq2})$ with time dependent $\beta (t)$ can make SIRS model more reasonable. The resulting SIRS model with time dependent transmission rate $\beta (t)$ is expressed as follow
$$
\begin{equation}
\begin{aligned} \label{eq:5}
  &amp; \frac{dS}{dt} = f(N - S - I) - \frac{\beta (t) SI}{N} <br />
  &amp; \frac{dI}{dt} = \frac{\beta (t) SI}{N} - \gamma I
\end{aligned}
\end{equation}
$$</p>

<h3 id="2-1-implementation">2.1 Implementation</h3>

<p>The <strong>RK4</strong> method for numerical integration of SIRS model with time dependent transmission rate $\beta(t)$ can be easily implemented by adding parameters to helper event functions.</p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span><span style="color: #586E75"># define infection rate</span>
inf.rate <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">beta</span><span style="color: #93A1A1">,</span> S<span style="color: #93A1A1">,</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span>beta <span style="color: #719e07">*</span> S <span style="color: #719e07">*</span> I <span style="color: #719e07">/</span> N<span style="color: #93A1A1">)</span>
<span style="color: #93A1A1">}</span>

<span style="color: #586E75"># define recovery rate</span>
rec.rate <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span>gamma <span style="color: #719e07">*</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span>
<span style="color: #93A1A1">}</span>

<span style="color: #586E75"># define immunity loss rate</span>
ilos.rate <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> f<span style="color: #93A1A1">,</span> S<span style="color: #93A1A1">,</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span>f <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>N <span style="color: #719e07">-</span> S <span style="color: #719e07">-</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">))</span>
<span style="color: #93A1A1">}</span>

<span style="color: #586E75"># beta is a numeric vector of length n or 1</span>
RK4SIRS <span style="color: #719e07">&lt;-</span> <span style="color: #268BD2">function</span><span style="color: #93A1A1">(</span>n<span style="color: #93A1A1">,</span> <span style="color: #719e07">beta</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> f<span style="color: #93A1A1">,</span> S0<span style="color: #93A1A1">,</span> I0<span style="color: #93A1A1">,</span> R0 <span style="color: #719e07">=</span> <span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> dt <span style="color: #719e07">=</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">,</span> incidence <span style="color: #719e07">=</span> <span style="color: #CB4B16">FALSE</span><span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
  N <span style="color: #719e07">&lt;&lt;-</span> S0 <span style="color: #719e07">+</span> I0 <span style="color: #719e07">+</span> R0
  
  S <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>S0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>
  I <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>I0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>
  R <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>R0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>
  CI <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>I0<span style="color: #93A1A1">,</span> <span style="color: #719e07">rep</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> n<span style="color: #93A1A1">))</span>  <span style="color: #586E75"># cummulative incidence</span>
  <span style="color: #268BD2">for</span> <span style="color: #93A1A1">(</span>i <span style="color: #268BD2">in</span> <span style="color: #2AA198">1</span><span style="color: #719e07">:</span>n<span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
    bti <span style="color: #719e07">&lt;-</span> <span style="color: #719e07">beta</span><span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    Si <span style="color: #719e07">&lt;-</span> S<span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    Ii <span style="color: #719e07">&lt;-</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    CIi <span style="color: #719e07">&lt;-</span> CI<span style="color: #93A1A1">[</span>i<span style="color: #93A1A1">]</span>
    
    Einf <span style="color: #719e07">&lt;-</span> inf.rate<span style="color: #93A1A1">(</span>i<span style="color: #93A1A1">,</span> bti<span style="color: #93A1A1">,</span> Si<span style="color: #93A1A1">,</span> Ii<span style="color: #93A1A1">)</span>  <span style="color: #586E75"># event of infection</span>
    Erec <span style="color: #719e07">&lt;-</span> rec.rate<span style="color: #93A1A1">(</span>i<span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> Ii<span style="color: #93A1A1">)</span>  <span style="color: #586E75"># event of recovery</span>
    Eilos <span style="color: #719e07">&lt;-</span> ilos.rate<span style="color: #93A1A1">(</span>i<span style="color: #93A1A1">,</span> f<span style="color: #93A1A1">,</span> Si<span style="color: #93A1A1">,</span> Ii<span style="color: #93A1A1">)</span>  <span style="color: #586E75"># event of immunity loss</span>
    S.k1 <span style="color: #719e07">&lt;-</span> Eilos <span style="color: #719e07">-</span> Einf
    I.k1 <span style="color: #719e07">&lt;-</span> Einf <span style="color: #719e07">-</span> Erec
    CI.k1 <span style="color: #719e07">&lt;-</span> Einf
    
    Einf <span style="color: #719e07">&lt;-</span> inf.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> bti<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k1<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k1<span style="color: #93A1A1">)</span>
    Erec <span style="color: #719e07">&lt;-</span> rec.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k1<span style="color: #93A1A1">)</span>
    Eilos <span style="color: #719e07">&lt;-</span> ilos.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> f<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k1<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k1<span style="color: #93A1A1">)</span>
    S.k2 <span style="color: #719e07">&lt;-</span> Eilos <span style="color: #719e07">-</span> Einf
    I.k2 <span style="color: #719e07">&lt;-</span> Einf <span style="color: #719e07">-</span> Erec
    CI.k2 <span style="color: #719e07">&lt;-</span> Einf
    
    Einf <span style="color: #719e07">&lt;-</span> inf.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> bti<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k2<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2<span style="color: #93A1A1">)</span>
    Erec <span style="color: #719e07">&lt;-</span> rec.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2<span style="color: #93A1A1">)</span>
    Eilos <span style="color: #719e07">&lt;-</span> ilos.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span><span style="color: #93A1A1">,</span> f<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k2<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2<span style="color: #93A1A1">)</span>
    S.k3 <span style="color: #719e07">&lt;-</span> Eilos <span style="color: #719e07">-</span> Einf
    I.k3 <span style="color: #719e07">&lt;-</span> Einf <span style="color: #719e07">-</span> Erec
    CI.k3 <span style="color: #719e07">&lt;-</span> Einf
    
    Einf <span style="color: #719e07">&lt;-</span> inf.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt<span style="color: #93A1A1">,</span> bti<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> S.k3<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> I.k3<span style="color: #93A1A1">)</span>
    Erec <span style="color: #719e07">&lt;-</span> rec.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt<span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> I.k3<span style="color: #93A1A1">)</span>
    Eilos <span style="color: #719e07">&lt;-</span> ilos.rate<span style="color: #93A1A1">(</span>i <span style="color: #719e07">+</span> dt<span style="color: #93A1A1">,</span> f<span style="color: #93A1A1">,</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> S.k3<span style="color: #93A1A1">,</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">*</span> I.k3<span style="color: #93A1A1">)</span>
    S.k4 <span style="color: #719e07">&lt;-</span> Eilos <span style="color: #719e07">-</span> Einf
    I.k4 <span style="color: #719e07">&lt;-</span> Einf <span style="color: #719e07">-</span> Erec
    CI.k4 <span style="color: #719e07">&lt;-</span> Einf
    
    S<span style="color: #93A1A1">[</span>i <span style="color: #719e07">+</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">]</span> <span style="color: #719e07">&lt;-</span> Si <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">6</span> <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>S.k1 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k2 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> S.k3 <span style="color: #719e07">+</span> S.k4<span style="color: #93A1A1">)</span>
    <span style="color: #719e07">I</span><span style="color: #93A1A1">[</span>i <span style="color: #719e07">+</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">]</span> <span style="color: #719e07">&lt;-</span> Ii <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">6</span> <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>I.k1 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k2 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> I.k3 <span style="color: #719e07">+</span> I.k4<span style="color: #93A1A1">)</span>
    CI<span style="color: #93A1A1">[</span>i <span style="color: #719e07">+</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">]</span> <span style="color: #719e07">&lt;-</span> CIi <span style="color: #719e07">+</span> dt <span style="color: #719e07">/</span> <span style="color: #2AA198">6</span> <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span>CI.k1 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> CI.k2 <span style="color: #719e07">+</span> <span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> CI.k3 <span style="color: #719e07">+</span> CI.k4<span style="color: #93A1A1">)</span>
  <span style="color: #93A1A1">}</span>
  R <span style="color: #719e07">&lt;-</span> N <span style="color: #719e07">-</span> S <span style="color: #719e07">-</span> <span style="color: #719e07">I</span>
  
  <span style="color: #268BD2">if</span> <span style="color: #93A1A1">(</span><span style="color: #719e07">!</span>incidence<span style="color: #93A1A1">)</span> <span style="color: #93A1A1">{</span>
    <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span><span style="color: #DC322F">data.frame</span><span style="color: #93A1A1">(</span>n <span style="color: #719e07">=</span> <span style="color: #2AA198">0</span> <span style="color: #719e07">:</span> n<span style="color: #93A1A1">,</span> S <span style="color: #719e07">=</span> S<span style="color: #93A1A1">,</span> I <span style="color: #719e07">=</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">,</span> R <span style="color: #719e07">=</span> R<span style="color: #93A1A1">))</span>
  <span style="color: #93A1A1">}</span> <span style="color: #268BD2">else</span> <span style="color: #93A1A1">{</span>
    <span style="color: #586E75"># newly infected per day (incidence)</span>
    inc <span style="color: #719e07">=</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span>I0<span style="color: #93A1A1">,</span> <span style="color: #719e07">diff</span><span style="color: #93A1A1">(</span>CI<span style="color: #93A1A1">))</span>
    <span style="color: #268BD2">return</span><span style="color: #93A1A1">(</span><span style="color: #DC322F">data.frame</span><span style="color: #93A1A1">(</span>n <span style="color: #719e07">=</span> <span style="color: #2AA198">0</span> <span style="color: #719e07">:</span> n<span style="color: #93A1A1">,</span> S <span style="color: #719e07">=</span> S<span style="color: #93A1A1">,</span> I <span style="color: #719e07">=</span> <span style="color: #719e07">I</span><span style="color: #93A1A1">,</span> R <span style="color: #719e07">=</span> R<span style="color: #93A1A1">,</span> inc <span style="color: #719e07">=</span> inc<span style="color: #93A1A1">,</span> cum.inc <span style="color: #719e07">=</span> CI<span style="color: #93A1A1">))</span>
  <span style="color: #93A1A1">}</span>
<span style="color: #93A1A1">}</span>
</pre></div>

<h3 id="2-2-simulation">2.2 Simulation</h3>

<p>The following simulation example is adapted from <em>Fig. 1a</em> in <a href="http://www.pnas.org/content/101/48/16915.abstract" target="_blank">Dushoff et al. (2004)</a>.</p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span>S0 <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">500000</span>
I0 <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">100</span>  <span style="color: #586E75"># I0 has little effect on the dynamic equilibrium</span>
R0 <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">0</span>
N <span style="color: #719e07">&lt;-</span> S0 <span style="color: #719e07">+</span> I0 <span style="color: #719e07">+</span> R0
L <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">4</span>  <span style="color: #586E75"># yr</span>
f <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">1</span> <span style="color: #719e07">/</span> L
D <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">0.02</span>  <span style="color: #586E75"># yr</span>
gamma <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">1</span> <span style="color: #719e07">/</span> D
dt <span style="color: #719e07">=</span> <span style="color: #2AA198">0.01</span>  <span style="color: #586E75"># yr</span>
t <span style="color: #719e07">=</span> <span style="color: #719e07">seq</span><span style="color: #93A1A1">(</span>from <span style="color: #719e07">=</span> <span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> to <span style="color: #719e07">=</span> <span style="color: #2AA198">20</span><span style="color: #93A1A1">,</span> by <span style="color: #719e07">=</span> dt<span style="color: #93A1A1">)</span>
beta0 <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">500</span>  <span style="color: #586E75"># persons per yr</span>
beta1 <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">0.04</span>
beta <span style="color: #719e07">&lt;-</span> beta0 <span style="color: #719e07">*</span> <span style="color: #93A1A1">(</span><span style="color: #2AA198">1</span> <span style="color: #719e07">+</span> beta1 <span style="color: #719e07">*</span> <span style="color: #719e07">cos</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">2</span> <span style="color: #719e07">*</span> <span style="color: #CB4B16">pi</span> <span style="color: #719e07">*</span> <span style="color: #719e07">t</span><span style="color: #93A1A1">))</span>
n <span style="color: #719e07">&lt;-</span> <span style="color: #719e07">length</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">[</span><span style="color: #2AA198">-1</span><span style="color: #93A1A1">])</span>

r <span style="color: #719e07">&lt;-</span> RK4SIRS<span style="color: #93A1A1">(</span>n<span style="color: #93A1A1">,</span> <span style="color: #719e07">beta</span><span style="color: #93A1A1">,</span> <span style="color: #719e07">gamma</span><span style="color: #93A1A1">,</span> S0<span style="color: #93A1A1">,</span> I0<span style="color: #93A1A1">,</span> f <span style="color: #719e07">=</span> f<span style="color: #93A1A1">,</span> dt <span style="color: #719e07">=</span> dt<span style="color: #93A1A1">,</span> incidence <span style="color: #719e07">=</span> <span style="color: #CB4B16">TRUE</span><span style="color: #93A1A1">)</span>
r <span style="color: #719e07">&lt;-</span> <span style="color: #719e07">cbind</span><span style="color: #93A1A1">(</span><span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> r<span style="color: #93A1A1">)</span>
<span style="color: #586E75"># plot S, I, R curves</span>
<span style="color: #719e07">library</span><span style="color: #93A1A1">(</span>reshape2<span style="color: #93A1A1">)</span>
r.plot <span style="color: #719e07">&lt;-</span> melt<span style="color: #93A1A1">(</span>r<span style="color: #93A1A1">,</span> id <span style="color: #719e07">=</span> <span style="color: #2AA198">&quot;t&quot;</span><span style="color: #93A1A1">,</span> measure <span style="color: #719e07">=</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">&quot;S&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;I&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;R&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;inc&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;cum.inc&quot;</span><span style="color: #93A1A1">))</span>
<span style="color: #586E75"># change levels for display</span>
<span style="color: #719e07">levels</span><span style="color: #93A1A1">(</span>r.plot<span style="color: #719e07">$</span>variable<span style="color: #93A1A1">)</span> <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">&quot;Susceptible&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;Infected&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;Recovered&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;Incidence&quot;</span><span style="color: #93A1A1">,</span> 
                             <span style="color: #2AA198">&quot;Cummulative incidence&quot;</span><span style="color: #93A1A1">)</span>
<span style="color: #719e07">library</span><span style="color: #93A1A1">(</span>ggplot2<span style="color: #93A1A1">)</span>
p <span style="color: #719e07">&lt;-</span> ggplot<span style="color: #93A1A1">(</span>r.plot<span style="color: #93A1A1">,</span> aes<span style="color: #93A1A1">(</span>x <span style="color: #719e07">=</span> <span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> y <span style="color: #719e07">=</span> value<span style="color: #93A1A1">,</span> group <span style="color: #719e07">=</span> variable<span style="color: #93A1A1">,</span> color <span style="color: #719e07">=</span> variable<span style="color: #93A1A1">))</span>
p <span style="color: #719e07">+</span> geom_line<span style="color: #93A1A1">()</span> <span style="color: #719e07">+</span> 
  xlab<span style="color: #93A1A1">(</span><span style="color: #2AA198">&quot;Time (years)&quot;</span><span style="color: #93A1A1">)</span> <span style="color: #719e07">+</span> 
  facet_wrap<span style="color: #93A1A1">(</span><span style="color: #719e07">~</span> variable<span style="color: #93A1A1">,</span> scales <span style="color: #719e07">=</span> <span style="color: #2AA198">&quot;free&quot;</span><span style="color: #93A1A1">)</span> <span style="color: #719e07">+</span> 
  ggtitle<span style="color: #93A1A1">(</span><span style="color: #2AA198">&quot;Simulation&quot;</span><span style="color: #93A1A1">)</span> <span style="color: #719e07">+</span> 
  theme_bw<span style="color: #93A1A1">(</span>base_size <span style="color: #719e07">=</span> <span style="color: #2AA198">12</span><span style="color: #93A1A1">)</span> <span style="color: #719e07">+</span> 
  theme<span style="color: #93A1A1">(</span>legend.position <span style="color: #719e07">=</span> <span style="color: #2AA198">&quot;none&quot;</span><span style="color: #93A1A1">)</span>
</pre></div>

<p><img src="http://tonytsai.name/materials/SIRS_files/figure-html/unnamed-chunk-13-1.png" alt="" /></p>

<p>In <em>Fig. 1a</em> simulation, the basic reproductive number $R_0=D\beta_0=$ 10, and the intrinsic period of oscillation $T=2\pi \sqrt{\frac{DL}{R_0-1}}=$ 0.59. As shown in above figures, after starting simulation for several years, the compartments of SIRS model (including <strong>incidence</strong>) are in dynamic equilibrium. To show the details of deterministic equilibrium, the following codes only plot the subset results of 10 ~ 20 years.</p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span>r.eqb <span style="color: #719e07">&lt;-</span> r<span style="color: #93A1A1">[</span>r<span style="color: #719e07">$</span>t <span style="color: #719e07">&gt;=</span> <span style="color: #2AA198">10</span><span style="color: #93A1A1">,</span> <span style="color: #93A1A1">]</span>
r.plot <span style="color: #719e07">&lt;-</span> melt<span style="color: #93A1A1">(</span>r.eqb<span style="color: #93A1A1">,</span> id <span style="color: #719e07">=</span> <span style="color: #2AA198">&quot;t&quot;</span><span style="color: #93A1A1">,</span> measure <span style="color: #719e07">=</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">&quot;S&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;I&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;R&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;inc&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;cum.inc&quot;</span><span style="color: #93A1A1">))</span>
<span style="color: #719e07">levels</span><span style="color: #93A1A1">(</span>r.plot<span style="color: #719e07">$</span>variable<span style="color: #93A1A1">)</span> <span style="color: #719e07">&lt;-</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">&quot;Susceptible&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;Infected&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;Recovered&quot;</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">&quot;Incidence&quot;</span><span style="color: #93A1A1">,</span> 
                             <span style="color: #2AA198">&quot;Cummulative incidence&quot;</span><span style="color: #93A1A1">)</span>
p <span style="color: #719e07">&lt;-</span> ggplot<span style="color: #93A1A1">(</span>r.plot<span style="color: #93A1A1">,</span> aes<span style="color: #93A1A1">(</span>x <span style="color: #719e07">=</span> <span style="color: #719e07">t</span><span style="color: #93A1A1">,</span> y <span style="color: #719e07">=</span> value<span style="color: #93A1A1">,</span> group <span style="color: #719e07">=</span> variable<span style="color: #93A1A1">,</span> color <span style="color: #719e07">=</span> variable<span style="color: #93A1A1">))</span>
p <span style="color: #719e07">+</span> geom_line<span style="color: #93A1A1">()</span> <span style="color: #719e07">+</span> 
  scale_x_continuous<span style="color: #93A1A1">(</span>breaks <span style="color: #719e07">=</span> <span style="color: #2AA198">10</span> <span style="color: #719e07">:</span> <span style="color: #2AA198">20</span><span style="color: #93A1A1">,</span> labels <span style="color: #719e07">=</span> <span style="color: #2AA198">10</span> <span style="color: #719e07">:</span> <span style="color: #2AA198">20</span><span style="color: #93A1A1">,</span> expand <span style="color: #719e07">=</span> <span style="color: #DC322F">c</span><span style="color: #93A1A1">(</span><span style="color: #2AA198">0</span><span style="color: #93A1A1">,</span> <span style="color: #2AA198">0</span><span style="color: #93A1A1">))</span> <span style="color: #719e07">+</span> 
  xlab<span style="color: #93A1A1">(</span><span style="color: #2AA198">&quot;Time (years)&quot;</span><span style="color: #93A1A1">)</span> <span style="color: #719e07">+</span> 
  facet_wrap<span style="color: #93A1A1">(</span><span style="color: #719e07">~</span> variable<span style="color: #93A1A1">,</span> scales <span style="color: #719e07">=</span> <span style="color: #2AA198">&quot;free&quot;</span><span style="color: #93A1A1">,</span> ncol <span style="color: #719e07">=</span> <span style="color: #2AA198">1</span><span style="color: #93A1A1">)</span> <span style="color: #719e07">+</span> 
  ggtitle<span style="color: #93A1A1">(</span><span style="color: #2AA198">&quot;Subset Results of Equilibrium&quot;</span><span style="color: #93A1A1">)</span> <span style="color: #719e07">+</span> 
  theme_bw<span style="color: #93A1A1">(</span>base_size <span style="color: #719e07">=</span> <span style="color: #2AA198">14</span><span style="color: #93A1A1">)</span> <span style="color: #719e07">+</span> 
  theme<span style="color: #93A1A1">(</span>legend.position <span style="color: #719e07">=</span> <span style="color: #2AA198">&quot;none&quot;</span><span style="color: #93A1A1">)</span>
</pre></div>

<p><img src="http://tonytsai.name/materials/SIRS_files/figure-html/unnamed-chunk-14-1.png" alt="" /></p>

<p>The <em>Fig. 1b</em> simulation is very similar to the one of Fig. 1a, but with different parameters of $L=8$ yr, $D=0.025$ yr, and $\beta_0=400$ persons per yr. The resulting plots of simulation are presented.</p>
<div class="highlight" style="background: #002B36"><pre style="line-height: 125%"><span></span>L <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">8</span>  <span style="color: #586E75"># yr</span>
D <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">0.025</span>  <span style="color: #586E75"># yr</span>
beta0 <span style="color: #719e07">&lt;-</span> <span style="color: #2AA198">400</span>  <span style="color: #586E75"># persons per yr</span>
</pre></div>

<p><img src="http://tonytsai.name/materials/SIRS_files/figure-html/unnamed-chunk-16-1.png" alt="" /></p>

<p><img src="http://tonytsai.name/materials/SIRS_files/figure-html/unnamed-chunk-17-1.png" alt="" /></p>

<p>In <em>Fig. 1b</em> simulation, the basic reproductive number $R_0=$ 10, and the intrinsic period of oscillation $T=$ 0.94. From the <code>Infected</code> panel of <code>Subset Results of Equilibrium</code> figure, strong oscillations (noticing the y-axis range) due to <strong>resonance</strong> are observed. This is because comparing with <em>Fig. 1a</em> simulation, while the basic reprodutive number $R_0$ keeps the same, the period of endogenous SIRS oscillation $T$ is much more near the period of seasonal forcing (<strong>1</strong> year) (see <a href="http://www.pnas.org/content/101/48/16915.abstract" target="_blank">Dushoff et al. (2004)</a> for further details).</p>

        </div>
        

<footer>
  <p class="meta">
    <span class="byline author vcard">Posted by <span class="fn">Tony Tsai</span></span>
    
    <time>Dec 4, 2014</time>
    
      <span class="categories">
        Tags:
        
          <a class="category" href="http://blog.tonytsai.name/tags/sirs">SIRS</a>  <a class="category" href="http://blog.tonytsai.name/tags/transmission-rate">Transmission Rate</a>  <a class="category" href="http://blog.tonytsai.name/tags/basic-reproductive-number">Basic Reproductive Number</a>  <a class="category" href="http://blog.tonytsai.name/tags/markov-chain-transition-rate">Markov Chain Transition Rate</a>  
    
    </span>
  </p>

  
  

  

  <p class="meta">
    
        <a class="basic-alignment left" href="http://blog.tonytsai.name/blog/2014-12-03-gains-from-paper-reading/" title="Gains from Paper Reading">Gains from Paper Reading</a>
    

    
      <a class="basic-alignment right" href="http://blog.tonytsai.name/blog/2015-04-20-stratified-importance-sampling/" title="Stratified Importance Sampling">Stratified Importance Sampling</a>
    
  </p>
  
    
      <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    
    

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'tonytsai';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
 
    
  
  
</footer>

      </article>
    </div>
    

<aside class="sidebar thirds">
  <section class="first odd">

    
      <h1>Who am I</h1>
    

    <p>
      
        I am Jun (Tony) Cai (Tsai). A Ph.D. candidate interested in influenza transmission dynamics at Department of Earth System Science, Tsinghua University.
    </br>
    View my profile in <a href="https://scholar.google.com/citations?user=_dV_jnkAAAAJ" target="_blank">Google Scholar</a>.
      
    </p>
  </section>



  
  <ul class="sidebar-nav">
    <li class="sidebar-nav-item">
      <a target="_blank" href="https://github.com/caijun/" title="https://github.com/caijun/"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a target="_blank" href="https://twitter.com/caijun2046/" title="https://twitter.com/caijun2046/"><i class="fa fa-twitter fa-3x"></i></a>
       
      
      
      
      <a target="_blank" href="https://www.facebook.com/tony.tsai.007/" title="https://www.facebook.com/tony.tsai.007/"><i class="fa fa-facebook fa-3x"></i></a>
      
      
      <a target="_blank" href="http://weibo.com/caijun2046/" title="http://weibo.com/caijun2046/"><i class="fa fa-weibo fa-3x"></i></a>

    
    
    </li>
  </ul>

  

  

  
  
  
    
      <section class="even">
        <h1>Recent Posts</h1>
        <ul id="recent_posts">
          
            <li class="post">
              <a href="/blog/2017-01-05-test-mathjax/">Test MathJax</a>
            </li>
          
            <li class="post">
              <a href="/blog/2015-08-09-optimization-of-disk-usage-for-animint/">Optimization of Disk Usage for animint</a>
            </li>
          
            <li class="post">
              <a href="/blog/2015-05-21-operator-for-extracting-named-list-elements-to-variables/">Operator for Extracting Named List Elements to Variables</a>
            </li>
          
            <li class="post">
              <a href="/blog/2015-05-10-resources-for-influenza-research/">Resources for Influenza Research</a>
            </li>
          
            <li class="post">
              <a href="/blog/2015-04-23-why-does-the-jackknife-estimate-of-standard-error-have-the-factor-n-1/n/">Why Does the Jackknife Estimate of Standard Error Have the Factor (n-1)/n?</a>
            </li>
          
        </ul>
      </section>
    
  
  
  <section class="even">
    <h1>Books to Read</h1>
    <li><a href="https://www.amazon.com/Textbook-Influenza-Robert-G-Webster/dp/0470670487/">Textbook of Influenza</a></li>
    <li><a href="https://www.amazon.com/Infectious-Diseases-Humans-Dynamics-Publications/dp/019854040X">Infectious Diseases of Humans: Dynamics and Control</a></li>
    <li><a href="https://www.amazon.com/Modeling-Infectious-Diseases-Humans-Animals/dp/0691116172/">Modeling Infectious Diseases in Humans and Animals</a></li>
    <li><a href="https://www.amazon.com/Infectious-Disease-Epidemiology-Theory-Practice/dp/1449683797">Infectious Disease Epidemiology: Theory and Practice</a></li>
    <li><a href="https://www.amazon.com/Bayesian-Analysis-Chapman-Statistical-Science/dp/1439840954">Bayesian Data Analysis</a></li>
    <li><a href="https://www.amazon.com/Seamless-Integration-Rcpp-Dirk-Eddelbuettel/dp/1461468671">Seamless R and C++ Integration with Rcpp</a></li>

    <h1>Links</h1>
    <li><a href="http://www.repidemicsconsortium.org/">R Epidemics Consortium</a></li>
    <li><a href="http://r-bloggers.com/">R-bloggers</a></li>

    <h1>Friends</h1>
    <li><a href="https://xg1990.com/blog/">xg1990</a></li>
  </section>

  <script type="text/javascript" src="//ra.revolvermaps.com/0/0/8.js?i=0551xokm7cj&amp;m=0&amp;s=300&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33" async="async"></script>

</aside>

  </div>
</div>

<footer role="contentinfo">
  <p>Copyright &copy; 2017 Tony Tsai - <a href="http://blog.tonytsai.name/license/">License</a> -
  <span class="credit">Powered by <a target="_blank" href="https://gohugo.io">Hugo</a> and <a target="_blank" href="https://github.com/parsiya/hugo-octopress/">Hugo-Octopress</a> theme.
</p>

</footer>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] },
  tex2jax: {
    inlineMath: [['$','$']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<script type="text/javascript"
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script>
  var _gaq=[['_setAccount','UA-40665800-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>

