<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Benchmark on Tony Tsai</title>
    <link>http://blog.tonytsai.name/tags/benchmark/index.xml</link>
    <description>Recent content in Benchmark on Tony Tsai</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="http://blog.tonytsai.name/tags/benchmark/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>RK4 Method for Solving SIR Model</title>
      <link>http://blog.tonytsai.name/blog/2014-11-24-rk4-method-for-solving-sir-model/</link>
      <pubDate>Mon, 24 Nov 2014 23:44:46 -0400</pubDate>
      
      <guid>http://blog.tonytsai.name/blog/2014-11-24-rk4-method-for-solving-sir-model/</guid>
      <description>

&lt;p&gt;My object is to rewrite the 4th order Runge-Kutta (abbreviated for &lt;strong&gt;RK4&lt;/strong&gt;) method for solving the absolute humidity-driven SIRS model developed by &lt;a href=&#34;http://www.ploscompbiol.org/article/info%3Adoi%2F10.1371%2Fjournal.pcbi.1003583&#34; target=&#34;_blank&#34;&gt;Yang et al. (2014)&lt;/a&gt; in &lt;code&gt;R&lt;/code&gt; language. The details of the SIRS model are provided in the paper.&lt;/p&gt;

&lt;h2 id=&#34;1-rk4&#34;&gt;1 RK4&lt;/h2&gt;

&lt;h3 id=&#34;1-1-preliminary&#34;&gt;1.1 Preliminary&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;RK4&lt;/strong&gt; is one of the classic methods for numerical integration of ODE models. A brief introduction of &lt;strong&gt;RK4&lt;/strong&gt; refers to &lt;a href=&#34;http://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods&#34; target=&#34;_blank&#34;&gt;Wikipedia&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Consider the following initial value problem of ODE
&lt;div&gt;
$$
\begin{equation}
\begin{aligned}
  &amp;amp; \frac{dy}{dt} = f(t, y) \\&lt;br /&gt;
  &amp;amp; y(t_0) = y_0
\end{aligned}
\label{eq1}
\end{equation}
$$
&lt;/div&gt;
where $y(t)$ is the unknown function (scalar or &lt;strong&gt;vector&lt;/strong&gt;) which I would like to approximate.&lt;/p&gt;

&lt;p&gt;The iterative formula of &lt;strong&gt;RK4&lt;/strong&gt; method for solving ODE $(\ref{eq1})$ is as follows
$$
\begin{equation}
\begin{aligned}
  &amp;amp; y_{n + 1} = y_n + \frac{\Delta t}{6}(k_1 + 2k_2 + 2k_3 + k_4) \\&lt;br /&gt;
  &amp;amp; k_1 = f(t_n, y_n) \\&lt;br /&gt;
  &amp;amp; k_2 = f(t_n + \frac{\Delta t}{2}, y_n + \frac{k_1\Delta t}{2}) \\&lt;br /&gt;
  &amp;amp; k_3 = f(t_n + \frac{\Delta t}{2}, y_n + \frac{k_2\Delta t}{2}) \\&lt;br /&gt;
  &amp;amp; k_4 = f(t_n + \Delta t, y_n + k_3\Delta t) \\&lt;br /&gt;
  &amp;amp; t_{n + 1} = t_n + \Delta t \\&lt;br /&gt;
  &amp;amp; n = 0, 1, 2, 3, \dots
\end{aligned}
\label{eq2}
\end{equation}
$$&lt;/p&gt;

&lt;p&gt;For simplicity, here I use the simplest &lt;a href=&#34;http://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology&#34; target=&#34;_blank&#34;&gt;SIR model&lt;/a&gt; rather than the SIRS model used in the paper to examine whether the &lt;strong&gt;RK4&lt;/strong&gt; method has been implemented correctly. The SIR model is defined as follows
$$
\begin{equation} \label{eq3}
\begin{aligned}
  &amp;amp; \frac{dS}{dt} = -\frac{\beta SI}{N} \\&lt;br /&gt;
  &amp;amp; \frac{dI}{dt} = \frac{\beta SI}{N} - \gamma I \\&lt;br /&gt;
  &amp;amp; \frac{dR}{dt} = \gamma I
\end{aligned}
\end{equation}
$$
where $S(t)$ is the number of susceptible people in the population at time $t$, $I(t)$ is the number of infectious people at time $t$, $R(t)$ is the number of recovered people at time $t$, $\beta$ is the transmission rate, $\gamma$ represents the recovery rate, and $N = S(t) + I(t) + R(t)$ is the fixed population.&lt;/p&gt;

&lt;p&gt;According to the general iterative formula $(\ref{eq2})$, the iterative formulas for $S(t)$, $I(t)$ and $R(t)$ of SIR model can be written out.
$$
\begin{equation}
\begin{aligned}
  &amp;amp; S_{n + 1} = S_n + \frac{\Delta t}{6}(k_1^S + 2k_2^S + 2k_3^S + k_4^S) \\&lt;br /&gt;
  &amp;amp; k_1^S = f(t_n, S_n, I_n) = -\frac{\beta S_nI_n}{N} \\&lt;br /&gt;
  &amp;amp; k_2^S = f(t_n + \frac{\Delta t}{2}, S_n + \frac{k_1^S\Delta t}{2}, I_n + \frac{k_1^I\Delta t}{2}) = -\frac{\beta}{N}(S_n + \frac{k_1^S\Delta t}{2})(I_n + \frac{k_1^I\Delta t}{2}) \\&lt;br /&gt;
  &amp;amp; k_3^S = f(t_n + \frac{\Delta t}{2}, S_n + \frac{k_2^S\Delta t}{2}, I_n + \frac{k_2^I\Delta t}{2}) = -\frac{\beta}{N}(S_n + \frac{k_2^S\Delta t}{2})(I_n + \frac{k_2^I\Delta t}{2}) \\&lt;br /&gt;
  &amp;amp; k_4^S = f(t_n + \Delta t, S_n + k_3^S\Delta t, I_n + k_3^I\Delta t) = -\frac{\beta}{N}(S_n + k_3^S\Delta t)(I_n + k_3^I\Delta t)
\end{aligned}
\end{equation}
$$&lt;/p&gt;

&lt;p&gt;$$
\begin{equation}
\begin{aligned}
  &amp;amp; I_{n + 1} = I_n + \frac{\Delta t}{6}(k_1^I + 2k_2^I + 2k_3^I + k_4^I) \\&lt;br /&gt;
  &amp;amp; k_1^I = f(t_n, S_n, I_n) = \frac{\beta S_nI_n}{N} - \gamma I_n \\&lt;br /&gt;
  &amp;amp; k_2^I = f(t_n + \frac{\Delta t}{2}, S_n + \frac{k_1^S\Delta t}{2}, I_n + \frac{k_1^I\Delta t}{2}) = \frac{\beta}{N}(S_n + \frac{k_1^S\Delta t}{2})(I_n + \frac{k_1^I\Delta t}{2}) - \gamma (I_n + \frac{k_1^I\Delta t}{2}) \\&lt;br /&gt;
  &amp;amp; k_3^I = f(t_n + \frac{\Delta t}{2}, S_n + \frac{k_2^S\Delta t}{2}, I_n + \frac{k_2^I\Delta t}{2}) = \frac{\beta}{N}(S_n + \frac{k_2^S\Delta t}{2})(I_n + \frac{k_2^I\Delta t}{2}) - \gamma (I_n + \frac{k_2^I\Delta t}{2}) \\&lt;br /&gt;
  &amp;amp; k_4^I = f(t_n + \Delta t, S_n + k_3^S\Delta t, I_n + k_3^I\Delta t) = \frac{\beta}{N}(S_n + k_3^S\Delta t)(I_n + k_3^I\Delta t) - \gamma (I_n + k_3^I\Delta t)
\end{aligned}
\end{equation}
$$&lt;/p&gt;

&lt;p&gt;$$
\begin{equation}
\begin{aligned}
  &amp;amp; R_{n + 1} = R_n + \frac{\Delta t}{6}(k_1^R + 2k_2^R + 2k_3^R + k_4^R) \\&lt;br /&gt;
  &amp;amp; k_1^R = f(t_n, I_n) = \gamma I_n \\&lt;br /&gt;
  &amp;amp; k_2^R = f(t_n + \frac{\Delta t}{2}, I_n + \frac{k_1^I\Delta t}{2}) = \gamma (I_n + \frac{k_1^I\Delta t}{2}) \\&lt;br /&gt;
  &amp;amp; k_3^R = f(t_n + \frac{\Delta t}{2}, I_n + \frac{k_2^I\Delta t}{2}) = \gamma (I_n + \frac{k_2^I\Delta t}{2}) \\&lt;br /&gt;
  &amp;amp; k_4^R = f(t_n + \Delta t, I_n + k_3^I\Delta t) = \gamma (I_n + k_3^I\Delta t)
\end{aligned}
\end{equation}
$$&lt;/p&gt;

&lt;p&gt;Note that since the population $N = S(t) + I(t) + R(t)$ is constant, there will have $\frac{dS}{dt} + \frac{dI}{dt} + \frac{dR}{dt} = 0$. Therefore, only two of the three ODEs are independent and sufficient to solve the ODEs. Here, only iterative formulas for $S(t)$ and $I(t)$ are used and $R(t)$ is calculated by $R(t) = N - S(t) - I(t)$.&lt;/p&gt;

&lt;p&gt;The specific simulation parameters for SIR model are from the study case of &lt;a href=&#34;https://www.math.duke.edu//education/ccp/materials/diffcalc/sir/sir1.html&#34; target=&#34;_blank&#34;&gt;spread of Hong Kong flu in New York city&lt;/a&gt;. The inital values for the population variables are
$$
\begin{aligned}
  &amp;amp; S(0) = 7,900,000 \\&lt;br /&gt;
  &amp;amp; I(0) = 10 \\&lt;br /&gt;
  &amp;amp; R(0) = 0 \\&lt;br /&gt;
  &amp;amp; N = S(0) + I(0) + R(0) = 7,900,010
\end{aligned}
$$
and the values for the parameters are $\beta = \frac{1}{2}$, $\gamma = \frac{1}{3}$. All the following numerical methods solve the SIR model with a step size $\Delta t = 1$ day and time steps $t$ ranging from 0 to 200 days.&lt;/p&gt;

&lt;h3 id=&#34;1-2-rk4sir-function&#34;&gt;1.2 &lt;code&gt;RK4SIR&lt;/code&gt; function&lt;/h3&gt;

&lt;p&gt;Firstly, I need three helper functions to describe the dynamic of &lt;strong&gt;S&lt;/strong&gt;, &lt;strong&gt;I&lt;/strong&gt; and &lt;strong&gt;R&lt;/strong&gt; compartments of SIR model. For variants of SIR model, these functions can be easily modified accordingly.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;dSdt &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #268BD2&#34;&gt;function&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;t&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #268BD2&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; beta &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; N&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;

dIdt &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #268BD2&#34;&gt;function&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;t&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #268BD2&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;beta &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; N &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; gamma &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;

dRdt &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #268BD2&#34;&gt;function&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;t&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #268BD2&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;gamma &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Note that the &lt;code&gt;dRdt&lt;/code&gt; function will not be called hereinafter. Here, it&amp;rsquo;s still defined just for the integrity of SIR model and easily understanding.&lt;/p&gt;

&lt;p&gt;Secondly, as per the algorithm of &lt;strong&gt;RK4&lt;/strong&gt;, I create the following &lt;code&gt;RK4SIR&lt;/code&gt; function to solve the SIR model.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;RK4SIR &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #268BD2&#34;&gt;function&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R0 &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
  N &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;&amp;lt;-&lt;/span&gt; S0 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; I0 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; R0  &lt;span style=&#34;color: #586E75&#34;&gt;# fixed population&lt;/span&gt;
  
  S &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  I &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  R &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;R0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  &lt;span style=&#34;color: #268BD2&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #268BD2&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
    Si &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt;
    Ii &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;#     Ri &amp;lt;- R[i]&lt;/span&gt;
    
    S.k1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;#     R.k1 &amp;lt;- dRdt(i, Ii)&lt;/span&gt;
    
    S.k2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k1&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k1&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k1&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k1&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;#     R.k2 &amp;lt;- dRdt(i + dt / 2, Ii + dt / 2 * I.k1)&lt;/span&gt;
    
    S.k3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k2&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k2&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k2&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k2&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;#     R.k3 &amp;lt;- dRdt(i + dt / 2, Ii + dt / 2 * I.k2)&lt;/span&gt;
    
    S.k4 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k3&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k3&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k4 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k3&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k3&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;#     R.k4 &amp;lt;- dRdt(i + dt, Ii + dt * I.k3)&lt;/span&gt;
    
    S&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;S.k1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k3 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; S.k4&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;I.k1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k3 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; I.k4&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;#     R[i + 1] &amp;lt;- Ri + dt / 6 * (R.k1 + 2 * R.k2 + 2 * R.k3 + R.k4)&lt;/span&gt;
  &lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
  R &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; N &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;
  &lt;span style=&#34;color: #268BD2&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #DC322F&#34;&gt;data.frame&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; R&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Last, call &lt;code&gt;RK4SIR&lt;/code&gt; to simulate the spread of Hong Kong flu in New York city.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;S0 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;7900000&lt;/span&gt;
I0 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;10&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;# R0 &amp;lt;- 0&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;# N &amp;lt;- S0 + I0 + R0&lt;/span&gt;
beta &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;
gamma &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;3&lt;/span&gt;
n &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;200&lt;/span&gt;

r &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; RK4SIR&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I0&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Use &lt;code&gt;ggplot2&lt;/code&gt; package to plot the resulting $S(t)$, $I(t)$ and $R(t)$ curves.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;library&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;reshape2&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
r.plot &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; melt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; id &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;n&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; measure &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;S&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;I&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;R&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
&lt;span style=&#34;color: #719e07&#34;&gt;library&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;ggplot2&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
p &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; ggplot&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r.plot&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; aes&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;x &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; y &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; value&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; group &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; variable&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; color &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; variable&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
p &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; geom_line&lt;span style=&#34;color: #93A1A1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; 
  ggtitle&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;Spread of Hong Kong Flu in New York City&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&#34;http://tonytsai.name/materials/RK4SIR_files/figure-html/unnamed-chunk-4-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;For the spread dynamic of the disease, I am interested in the time $t_{max}$ when the number of infected people gets maximum and the corresponding maximum number of infected people $I_{max}$. $t_{max}$ and $I_{max}$ are also key measures to evaluate the performance of the absolute humidity-driven SIRS model in &lt;a href=&#34;http://www.ploscompbiol.org/article/info%3Adoi%2F10.1371%2Fjournal.pcbi.1003583&#34; target=&#34;_blank&#34;&gt;Yang et al. (2014)&lt;/a&gt;. The following codes give $t_{max}$ and $I_{max}$.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;which.max&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #719e07&#34;&gt;$I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## [1] 75
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;max&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #719e07&#34;&gt;$I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## [1] 497473.6
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Comparing to the results of the study case &lt;a href=&#34;https://www.math.duke.edu//education/ccp/materials/diffcalc/sir/sir2.html&#34; target=&#34;_blank&#34;&gt;The SIR Model for Spread of Disease&lt;/a&gt;, the trends of $S(t)$, $I(t)$ and $R(t)$ curves are correct. Furthermore, $t_{max} = 75$ is the same to the approximate value of 75 identified from the figure.&lt;/p&gt;

&lt;h3 id=&#34;1-3-rk4sir-yang-function&#34;&gt;1.3 &lt;code&gt;RK4SIR.Yang&lt;/code&gt; function&lt;/h3&gt;

&lt;p&gt;Based on the &lt;code&gt;propagateParSIR&lt;/code&gt; function from the code shipping with &lt;a href=&#34;http://www.ploscompbiol.org/article/info%3Adoi%2F10.1371%2Fjournal.pcbi.1003583&#34; target=&#34;_blank&#34;&gt;Yang et al. (2014)&lt;/a&gt;, I just reproduce the algorithm for easily understanding and create the following function &lt;code&gt;RK4SIR.Yang&lt;/code&gt; to solve the SIR model.&lt;/p&gt;

&lt;p&gt;

&lt;figure class=&#34;code&#34;&gt;
  &lt;figcaption&gt;
  	&lt;span&gt;&lt;/span&gt;
  &lt;/figcaption&gt;
  &lt;div class=&#34;codewrapper&#34;&gt;
    &lt;table class=&#34;highlighttable&#34;&gt;&lt;tr&gt;&lt;td&gt;&lt;div class=&#34;linenodiv&#34; style=&#34;background-color: #f0f0f0; padding-right: 10px&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt; 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;RK4SIR.Yang &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #268BD2&#34;&gt;function&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R0 &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
  N &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;&amp;lt;-&lt;/span&gt; S0 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; I0 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; R0  &lt;span style=&#34;color: #586E75&#34;&gt;# fixed population&lt;/span&gt;
  
  S &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  I &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  R &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;R0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  &lt;span style=&#34;color: #268BD2&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #268BD2&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
    Si &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt;
    Ii &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt;
    S.k1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    
    Ts1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k1
    Ti1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k1
    S.k2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts1&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti1&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts1&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti1&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    
    Ts2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ts1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k2
    Ti2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ti1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k2
    S.k3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts2&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti2&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts2&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti2&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    
    Ts3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ts2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k3
    Ti3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ti2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k3
    S.k4 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts3&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti3&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k4 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts3&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti3&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    
    S&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;S.k1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k3 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; S.k4&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;I.k1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k3 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; I.k4&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    R&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; N &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt;
  &lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
  &lt;span style=&#34;color: #268BD2&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #DC322F&#34;&gt;data.frame&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; R&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
  &lt;/div&gt;
&lt;/figure&gt;

Note that &lt;code&gt;RK4SIR.Yang&lt;/code&gt; is a bit different from &lt;code&gt;RK4SIR&lt;/code&gt; in calculating $k_1$, $k_2$, $k_3$ and $k_4$. The functionality of &lt;code&gt;RK4SIR.Yang&lt;/code&gt; is also tested by the same case.&lt;/p&gt;

&lt;p&gt;Call &lt;code&gt;RK4SIR.Yang&lt;/code&gt; to simulate the spread of Hong Kong flu in New York city.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;r &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; RK4SIR.Yang&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I0&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Plot $S(t)$, $I(t)$ and $R(t)$ curves.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;r.plot &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; melt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; id &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;n&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; measure &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;S&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;I&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;R&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
p &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; ggplot&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r.plot&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; aes&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;x &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; y &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; value&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; group &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; variable&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; color &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; variable&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
p &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; geom_line&lt;span style=&#34;color: #93A1A1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; 
  ggtitle&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;Spread of Hong Kong Flu in New York City&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&#34;http://tonytsai.name/materials/RK4SIR_files/figure-html/unnamed-chunk-8-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Extract $t_{max}$ and $I_{max}$.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;which.max&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #719e07&#34;&gt;$I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## [1] 72
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;max&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #719e07&#34;&gt;$I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## [1] 482429.6
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Comparing to the results of &lt;code&gt;RK4SIR&lt;/code&gt;, the results of &lt;code&gt;RK4SIR.Yang&lt;/code&gt; show that the infected indiviuals reaching peak is 3 days earlier and the number of infected individuals is more than 15,000 less. I doubt the &lt;code&gt;RK4SIR.Yang&lt;/code&gt; function gives a wrong solution. To figure out which function (&lt;code&gt;RK4SIR&lt;/code&gt; or &lt;code&gt;RK4SIR.Yang&lt;/code&gt;) implements the &lt;strong&gt;RK4&lt;/strong&gt; method correctly,  I also solve the SIR model by directly calling ODE solvers from the existing software package, including &lt;code&gt;deSolve&lt;/code&gt; package and &lt;code&gt;MATLAB&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&#34;1-4-desolve-package&#34;&gt;1.4 &lt;code&gt;deSolve&lt;/code&gt; package&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;http://cran.r-project.org/web/packages/deSolve/index.html&#34; target=&#34;_blank&#34;&gt;&lt;code&gt;deSolve&lt;/code&gt;&lt;/a&gt; package provides general solvers for inital value problems of ODE, PDE, DAE and DDE. &lt;code&gt;rk4&lt;/code&gt; function from &lt;code&gt;deSolve&lt;/code&gt; package is an implementation of the classical &lt;strong&gt;RK4&lt;/strong&gt; integration algorithm. The steps of invoking &lt;code&gt;rk4&lt;/code&gt; function to solve the SIR model are as follows.&lt;/p&gt;

&lt;p&gt;Firstly, define the initial values and parameters used in the SIR model.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #586E75&#34;&gt;# initial (state) values for SIR model&lt;/span&gt;
y0 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;S &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;# vector of time steps&lt;/span&gt;
times &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt; n
&lt;span style=&#34;color: #586E75&#34;&gt;# vector of parameters used in SIR model&lt;/span&gt;
params &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;beta &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; gamma &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Secondly, define the SIR model.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;SIR &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #268BD2&#34;&gt;function&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;t&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; y&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; params&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #719e07&#34;&gt;with&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;as.list&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;params&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; y&lt;span style=&#34;color: #93A1A1&#34;&gt;)),&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
    dS &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; beta &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; N
    dI &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; beta &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; N &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; gamma &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;
    dR &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; gamma &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;
    &lt;span style=&#34;color: #DC322F&#34;&gt;list&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;dS&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; dI&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; dR&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  &lt;span style=&#34;color: #93A1A1&#34;&gt;})&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Last, call &lt;code&gt;rk4&lt;/code&gt; function to solve the SIR model and plot the results.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;library&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;deSolve&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
r &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt;  rk4&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;y0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; times&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; SIR&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; params&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
plot&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&#34;http://tonytsai.name/materials/RK4SIR_files/figure-html/unnamed-chunk-12-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Similarly, extract $t_{max}$ and $I_{max}$.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;which.max&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #93A1A1&#34;&gt;[,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;I&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## [1] 75
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;max&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #93A1A1&#34;&gt;[,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;I&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## [1] 497473.6
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The results are the same to those of &lt;code&gt;RK4SIR&lt;/code&gt; function. As &lt;code&gt;deSolve&lt;/code&gt; is a mature package and has been used by numerous users, I believe the $t_{max} = 75$ and  $I_{max} = 4.97474\times 10^{5}$ given by &lt;code&gt;RK4SIR&lt;/code&gt; function are correct.&lt;/p&gt;

&lt;h3 id=&#34;1-5-ode45-function&#34;&gt;1.5 &lt;code&gt;ode45&lt;/code&gt; function&lt;/h3&gt;

&lt;p&gt;Furthermore, I solve the SIR model by calling &lt;code&gt;ode45&lt;/code&gt; function from &lt;code&gt;MATLAB&lt;/code&gt; to further confirm my judgement. The codes are organized in two &lt;code&gt;MATLAB&lt;/code&gt; scripts &lt;code&gt;SIR.m&lt;/code&gt; and &lt;code&gt;simSIR.m&lt;/code&gt;. Since the whole process is very similar to the &lt;code&gt;R&lt;/code&gt; code, I would not explain the codes in detail. Here, I just present the codes.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;SIR.m&lt;/code&gt; defines the ODEs of the SIR model.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;function&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt; &lt;/span&gt;dy &lt;span style=&#34;color: #93A1A1&#34;&gt;= &lt;/span&gt;&lt;span style=&#34;color: #268BD2&#34;&gt;SIR&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;t, y, beta, gamma, N&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;% only two ODEs of SIR model are independent&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;% solving three ODE together, MATLAB gives wrong solution&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;S&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;y(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;y(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;dS&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #B58900&#34;&gt;beta&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;S&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;N;&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;dI&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #B58900&#34;&gt;beta&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;S&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;N&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #B58900&#34;&gt;gamma&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;I;&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;dy&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;[dS,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;dI]&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #719e07&#34;&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;simSIR.m&lt;/code&gt; runs the specific simulation of the spread of Hong Kong flu in New York city and gives the results of interest.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;clear&lt;/span&gt;

&lt;span style=&#34;color: #93A1A1&#34;&gt;t&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;200&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;S0&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;7900000&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;I0&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;R0&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;N&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;S0&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;I0&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;R0;&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;y0&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;[S0,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;I0];&lt;/span&gt;
&lt;span style=&#34;color: #B58900&#34;&gt;beta&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #B58900&#34;&gt;gamma&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;options&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;[];&lt;/span&gt;

&lt;span style=&#34;color: #93A1A1&#34;&gt;[T,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;Y]&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;ode45(@SIR,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;t,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;y0,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;options,&lt;/span&gt; &lt;span style=&#34;color: #B58900&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #B58900&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;N);&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;% plot S, I, R curves&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;S&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;Y(:,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;Y(:,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;R&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;N&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;S&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;I;&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;plot(T,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;S,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;-r&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;T,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;I,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;-g&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;T,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;R,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;-b&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;title(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;Spread of Hong Kong Flu in New York City&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;xlabel(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;Days&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;ylabel(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;Value&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;legend(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;S&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;I&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;R&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;

&lt;span style=&#34;color: #586E75&#34;&gt;% peak of the infected&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;[maxVal,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;ind]&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;max(Y(:,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;% add veritical line to indicate the peak&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;ylim&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;get(gca,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;ylim&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;);&lt;/span&gt;  &lt;span style=&#34;color: #586E75&#34;&gt;%  get y range&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;hold&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;on&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;plot([ind&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;ind&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;],&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;[ylim(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;),&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;ylim(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)],&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;LineStyle&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;#39;--&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The results of running &lt;code&gt;simSIR.m&lt;/code&gt; are&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;simSIR&lt;/span&gt;

&lt;span style=&#34;color: #93A1A1&#34;&gt;ind&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt;

    &lt;span style=&#34;color: #2AA198&#34;&gt;75&lt;/span&gt;
    
&lt;span style=&#34;color: #93A1A1&#34;&gt;maxVal&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;=&lt;/span&gt;

   &lt;span style=&#34;color: #2AA198&#34;&gt;4.9755e+05&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&#34;http://tonytsai.name/materials/RK4SIR_files/figure-html/SIR.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Note that by default &lt;code&gt;MATLAB&lt;/code&gt;&amp;rsquo;s &lt;code&gt;ode45&lt;/code&gt; solver is &lt;a href=&#34;http://en.wikipedia.org/wiki/Dormand%E2%80%93Prince_method&#34; target=&#34;_blank&#34;&gt;DormandPrince method&lt;/a&gt; (alias &lt;code&gt;dopri5&lt;/code&gt;), which is also a member of the RungeKutta family of ODE solvers. As &lt;code&gt;ode45&lt;/code&gt; is adaptive stepsize integration algorithm, it can give more accurate numerical solution than &lt;strong&gt;RK4&lt;/strong&gt; method.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;rk45dp7&lt;/code&gt; (alias &lt;code&gt;ode45&lt;/code&gt;) method from &lt;code&gt;deSolve&lt;/code&gt; package provides &lt;code&gt;ode45&lt;/code&gt; solver for ODEs in &lt;code&gt;R&lt;/code&gt;. Solve the SIR model by using &lt;code&gt;ode45&lt;/code&gt; method in &lt;code&gt;deSolve&lt;/code&gt; and extract $t_{max}$ and $I_{max}$.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;r &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt;  ode&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;y0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; times&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; SIR&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; params&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; method &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; rkMethod&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;ode45&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;# peak of the infected&lt;/span&gt;
&lt;span style=&#34;color: #719e07&#34;&gt;which.max&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #93A1A1&#34;&gt;[,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;I&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## [1] 75
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;max&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #93A1A1&#34;&gt;[,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;I&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## [1] 497474.2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;$I_{max}$ given by &lt;code&gt;rk4&lt;/code&gt; and &lt;code&gt;ode45&lt;/code&gt; from &lt;code&gt;deSolve&lt;/code&gt; package are almost the same, but both are approximate 80 less than that of &lt;code&gt;ode45&lt;/code&gt; in &lt;code&gt;MATLAB&lt;/code&gt;. The results of &lt;code&gt;ode45&lt;/code&gt; provided by &lt;code&gt;R&lt;/code&gt; and &lt;code&gt;MATLAB&lt;/code&gt; are both right as the discrepancy results from the inherent difference in numerical precision between &lt;code&gt;R&lt;/code&gt; and &lt;code&gt;MATLAB&lt;/code&gt;. For more details refer to &lt;a href=&#34;http://blog.tonytsai.name/2014/11/Precision-Difference-of-ode45-between-R-and-MATLAB/&#34; target=&#34;_blank&#34;&gt;Appendix A&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The results given by both &lt;code&gt;deSolve&lt;/code&gt; package and &lt;code&gt;MATLAB&lt;/code&gt; show that $I_{max} = 75$ is the right answer. I am pretty sure that the results from &lt;code&gt;RK4SIR&lt;/code&gt; function are correct; however, the &lt;code&gt;RK4SIR.Yang&lt;/code&gt; function  ${\color{red}{doesn&amp;rsquo;t\ correctly}}$ implement &lt;strong&gt;RK4&lt;/strong&gt; method for solving SIR model. Since the &lt;code&gt;RK4SIR.Yang&lt;/code&gt; function gives a bit ealier $I_{max}$, I wonder whether this wrong &lt;strong&gt;RK4&lt;/strong&gt; method has any influence on the conclusions of &lt;a href=&#34;http://www.ploscompbiol.org/article/info%3Adoi%2F10.1371%2Fjournal.pcbi.1003583&#34; target=&#34;_blank&#34;&gt;Yang et al. (2014)&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;2-incidence&#34;&gt;2 Incidence&lt;/h2&gt;

&lt;h3 id=&#34;2-1-preliminary&#34;&gt;2.1 Preliminary&lt;/h3&gt;

&lt;p&gt;Instead of $S(t)$, $I(t)$ and $R(t)$ of SIR model, health workers in practice often collect daily number of newly infected people. This is the loosely expressed &lt;a href=&#34;http://en.wikipedia.org/wiki/Incidence_%28epidemiology%29&#34; target=&#34;_blank&#34;&gt;incidence&lt;/a&gt;. Besides incidence, cummulative incidence is also of interest. Let $C(t)$ denote incidence at time $t$, $P(t)$ denote cummulative incidence at time $t$. $C(t)$ and $P(t)$ can be calculated as follows
$$
\begin{aligned}
  &amp;amp; C(t) = \frac{dP}{dt} = \frac{\beta SI}{N} \\&lt;br /&gt;
  &amp;amp; C(t_0) = S_0 \\&lt;br /&gt;
  &amp;amp; P(t) = \int_0^t{C(t)}dt = \int_0^t{\frac{\beta SI}{N}}dt
\end{aligned}
$$&lt;/p&gt;

&lt;p&gt;In some references, &lt;a href=&#34;http://en.wikipedia.org/wiki/Incidence_%28epidemiology%29&#34; target=&#34;_blank&#34;&gt;cummulative incidence&lt;/a&gt; (also known as &lt;strong&gt;incidence proportion&lt;/strong&gt;) refers to the number of new cases $P(T)$ within a specified time period $T$ divided by the size of the population initially at risk $N$, expressed as $P(T)$ cases per $N$ persons, or $\frac{P(T)}{N}\times 100\%$. The rigorous definition of incidence is &lt;a href=&#34;http://en.wikipedia.org/wiki/Incidence_%28epidemiology%29#Incidence_rate&#34; target=&#34;_blank&#34;&gt;incidence rate&lt;/a&gt;, which is expressed as $P(T)$ cases per $N$ persons per $T$ time, or $\frac{P(T)}{N\times T}\times 100\%$.&lt;/p&gt;

&lt;h3 id=&#34;2-2-rk4sir-function&#34;&gt;2.2 &lt;code&gt;RK4SIR&lt;/code&gt; function&lt;/h3&gt;

&lt;p&gt;A logical parameter &lt;code&gt;incidence&lt;/code&gt; is added to &lt;code&gt;RK4SIR&lt;/code&gt; function to control whether or not incidence and cummulative incidence are returned.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;RK4SIR &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #268BD2&#34;&gt;function&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R0 &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; incidence &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #CB4B16&#34;&gt;FALSE&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
  N &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;&amp;lt;-&lt;/span&gt; S0 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; I0 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; R0
  
  S &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  I &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  R &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;R0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  &lt;span style=&#34;color: #268BD2&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #268BD2&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
    Si &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt;
    Ii &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt;
    
    S.k1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    
    S.k2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k1&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k1&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k1&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k1&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    
    S.k3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k2&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k2&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k2&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k2&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    
    S.k4 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k3&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k3&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k4 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k3&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k3&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    
    S&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;S.k1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k3 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; S.k4&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;I.k1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k3 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; I.k4&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
  &lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
  R &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; N &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;
  
  &lt;span style=&#34;color: #268BD2&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;!&lt;/span&gt;incidence&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #268BD2&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #DC322F&#34;&gt;data.frame&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; R&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  &lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #268BD2&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #586E75&#34;&gt;# newly infected per day (incidence)&lt;/span&gt;
    inc &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;diff&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;S&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
    &lt;span style=&#34;color: #586E75&#34;&gt;# cumulative incidence&lt;/span&gt;
    cum.inc &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;cumsum&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;inc&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #268BD2&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #DC322F&#34;&gt;data.frame&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; R&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; inc &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; inc&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; cum.inc &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; cum.inc&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  &lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Use the updated &lt;code&gt;RK4SIR&lt;/code&gt; function to track the time-varying incidence and cummulative incidence of the same study case.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;r &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; RK4SIR&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; incidence &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #CB4B16&#34;&gt;TRUE&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;# # plot S, I, R, incidence, cummulative incidence curves&lt;/span&gt;
r.plot &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; melt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; id &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;n&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; measure &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;S&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;I&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;R&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;inc&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;cum.inc&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
p &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; ggplot&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r.plot&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; aes&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;x &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; y &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; value&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; group &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; variable&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; color &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; variable&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
p &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; geom_line&lt;span style=&#34;color: #93A1A1&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; 
  scale_colour_discrete&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;name &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;Legend&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; 
                      breaks &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;S&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;I&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;R&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;inc&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;cum.inc&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;),&lt;/span&gt; 
                      labels &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;Susceptible&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;Infected &amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;Recovered&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;Incidence&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; 
                               &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;Cummulative incidence&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; 
  ggtitle&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;Spread of Hong Kong Flu in New York City&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&#34;http://tonytsai.name/materials/RK4SIR_files/figure-html/unnamed-chunk-16-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;As shown in the above figure, the time when incidence reaches peak is a bit earlier than that of the infected people. The following codes give the exact results.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;which.max&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #719e07&#34;&gt;$&lt;/span&gt;inc&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## [1] 73
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;max&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;r&lt;span style=&#34;color: #719e07&#34;&gt;$&lt;/span&gt;inc&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## [1] 173488.5
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;2-3-rk4sir-yang-function&#34;&gt;2.3 &lt;code&gt;RK4SIR.Yang&lt;/code&gt; function&lt;/h3&gt;

&lt;p&gt;I also update &lt;code&gt;RK4SIR.Yang&lt;/code&gt; function to return cummulative incidence based on the algorithm from &lt;code&gt;propagateParSIR&lt;/code&gt; function. The initial cummulative incidence $C_0$ is 0, which is $S_0$ in &lt;code&gt;RK4SIR&lt;/code&gt; function; however, I think it&amp;rsquo;s more consistent to set $C_0 = S_0$. Notably, the &lt;code&gt;RK4&lt;/code&gt; method for &lt;code&gt;RK4SIR.Yang&lt;/code&gt; hasn&amp;rsquo;t been corrected and the function doesn&amp;rsquo;t return incidence.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;RK4SIR.Yang &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #268BD2&#34;&gt;function&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R0 &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; incidence &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #CB4B16&#34;&gt;FALSE&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
  N &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;&amp;lt;-&lt;/span&gt; S0 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; I0 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; R0
  
  S &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  I &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  R &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #DC322F&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;R0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  cum.inc &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;rep&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; n &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;  &lt;span style=&#34;color: #586E75&#34;&gt;# cumulative incidence&lt;/span&gt;
  &lt;span style=&#34;color: #268BD2&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #268BD2&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
    Si &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt;
    Ii &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt;
    S.k1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Si&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ii&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    CI.k1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; S.k1
    
    Ts1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k1
    Ti1 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k1
    S.k2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts1&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti1&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts1&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti1&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    CI.k2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; S.k2
    
    Ts2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ts1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k2
    Ti2 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ti1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k2
    S.k3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts2&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti2&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts2&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti2&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    CI.k3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; S.k3
    
    Ts3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ts2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k3
    Ti3 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ti2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k3
    S.k4 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dSdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts3&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti3&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    I.k4 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; dIdt&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ts3&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; Ti3&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    CI.k4 &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; S.k4
    
    S&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Si &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;S.k1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; S.k3 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; S.k4&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; Ii &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;I.k1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; I.k3 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; I.k4&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
    R&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; N &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt;
    cum.inc&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; cum.inc&lt;span style=&#34;color: #93A1A1&#34;&gt;[&lt;/span&gt;i&lt;span style=&#34;color: #93A1A1&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; dt &lt;span style=&#34;color: #719e07&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;CI.k1 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; CI.k2 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;*&lt;/span&gt; CI.k3 &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; CI.k4&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
  &lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
  &lt;span style=&#34;color: #268BD2&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;!&lt;/span&gt;incidence&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #268BD2&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #DC322F&#34;&gt;data.frame&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; R&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  &lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #268BD2&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color: #93A1A1&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #268BD2&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #DC322F&#34;&gt;data.frame&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;:&lt;/span&gt; n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; S&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;I&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; R &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; R&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; cum.inc &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; cum.inc&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt;
  &lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #93A1A1&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&#34;2-4-benchmark&#34;&gt;2.4 Benchmark&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;microbenchmark&lt;/code&gt; package is a good option for benchmarking functions. I use &lt;code&gt;microbenchmark&lt;/code&gt; function to compare &lt;code&gt;rk4&lt;/code&gt;, &lt;code&gt;RK4SIR&lt;/code&gt; and &lt;code&gt;RK4SIR.Yang&lt;/code&gt; 1000 times.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #719e07&#34;&gt;library&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;microbenchmark&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
compare &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; microbenchmark&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;rk4&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;y0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; times&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; SIR&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; params&lt;span style=&#34;color: #93A1A1&#34;&gt;),&lt;/span&gt; 
                          RK4SIR&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; incidence &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #CB4B16&#34;&gt;TRUE&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;),&lt;/span&gt; 
                          RK4SIR.Yang&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;n&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;beta&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gamma&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; S0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; I0&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; incidence &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #CB4B16&#34;&gt;TRUE&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;),&lt;/span&gt; 
                          times &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #586E75&#34;&gt;# change expr for plot&lt;/span&gt;
compare&lt;span style=&#34;color: #719e07&#34;&gt;$&lt;/span&gt;expr &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gsub&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;rk4(y0, times, SIR, params)&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;rk4&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; 
                     compare&lt;span style=&#34;color: #719e07&#34;&gt;$&lt;/span&gt;expr&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; fixed &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #CB4B16&#34;&gt;TRUE&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
compare&lt;span style=&#34;color: #719e07&#34;&gt;$&lt;/span&gt;expr &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gsub&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;RK4SIR(n, beta, gamma, S0, I0, incidence = TRUE)&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;RK4SIR&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; 
                     compare&lt;span style=&#34;color: #719e07&#34;&gt;$&lt;/span&gt;expr&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; fixed &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #CB4B16&#34;&gt;TRUE&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
compare&lt;span style=&#34;color: #719e07&#34;&gt;$&lt;/span&gt;expr &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;gsub&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;RK4SIR.Yang(n, beta, gamma, S0, I0, incidence = TRUE)&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; 
                     &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;RK4SIR.Yang&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; compare&lt;span style=&#34;color: #719e07&#34;&gt;$&lt;/span&gt;expr&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; fixed &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #CB4B16&#34;&gt;TRUE&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
compare
&lt;/pre&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;## Unit: milliseconds
##         expr       min        lq      mean    median        uq       max
##          rk4 26.633415 26.808269 31.203988 27.158211 29.086869 63.952667
##       RK4SIR  3.767904  4.084908  4.628463  4.308558  5.080188  6.447710
##  RK4SIR.Yang  4.590251  4.771556  5.317731  4.902217  4.985512  8.661047
##  neval
##     10
##     10
##     10
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Draw a comparison of distribution times.&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #002B36&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;p &lt;span style=&#34;color: #719e07&#34;&gt;&amp;lt;-&lt;/span&gt; autoplot&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;compare&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
p &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; geom_violin&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;aes&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;color &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; expr&lt;span style=&#34;color: #93A1A1&#34;&gt;,&lt;/span&gt; fill &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; expr&lt;span style=&#34;color: #93A1A1&#34;&gt;))&lt;/span&gt; &lt;span style=&#34;color: #719e07&#34;&gt;+&lt;/span&gt; 
  theme&lt;span style=&#34;color: #93A1A1&#34;&gt;(&lt;/span&gt;legend.position &lt;span style=&#34;color: #719e07&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #2AA198&#34;&gt;&amp;quot;none&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #93A1A1&#34;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&#34;http://tonytsai.name/materials/RK4SIR_files/figure-html/unnamed-chunk-20-1.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;rk4&lt;/code&gt; function from &lt;code&gt;deSolve&lt;/code&gt; package runs much slower than both &lt;code&gt;RK4SIR&lt;/code&gt; and &lt;code&gt;RK4SIR.Yang&lt;/code&gt; fucntions as it takes much time to spin up for calling external &lt;code&gt;FORTRAN&lt;/code&gt; or &lt;code&gt;C&lt;/code&gt; functions. Though &lt;code&gt;RK4SIR&lt;/code&gt; function performs the extra calculation of incidence, the benchmarking results show that &lt;code&gt;RK4SIR&lt;/code&gt; function still runs faster than &lt;code&gt;RK4SIR.Yang&lt;/code&gt; function. This is because &lt;code&gt;RK4SIR.Yang&lt;/code&gt; function calculates cummulative incidence one by one per iterative formula while &lt;code&gt;RK4SIR&lt;/code&gt; function directly apply &lt;code&gt;diff&lt;/code&gt; function to the resulting vector &lt;code&gt;S&lt;/code&gt; to accomplish the calculation. &lt;code&gt;diff&lt;/code&gt; function is a vector operation and takes much less time.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>